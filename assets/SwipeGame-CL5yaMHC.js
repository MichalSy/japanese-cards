import{r as s,j as e,u as E,A as D,C as M,a as F,f as $,b as X}from"./index-2OFvoctg.js";function G(a,u){const[x,j]=s.useState("loading"),[n,c]=s.useState(0),[d,b]=s.useState([]),[S,r]=s.useState({}),[o,i]=s.useState([]),[g,f]=s.useState({correct:0,incorrect:0,mistakes:[]});s.useEffect(()=>{if(!a||a.length===0){j("error");return}const C=u==="all"?a.length:parseInt(u);let p=[];for(;p.length<C;){const m=C-p.length,v=[...a].sort(()=>Math.random()-.5).slice(0,m);p=[...p,...v]}const y={},l=[];p.forEach((m,v)=>{const I=Math.random()>.5;if(I)l.push(m);else{let w;do w=a[Math.floor(Math.random()*a.length)];while(w.romaji===m.romaji);l.push({...m,romaji:w.romaji})}y[`${v}-${m.id}`]=I}),b(p),i(l),r(y),j("playing")},[a,u]);const k=s.useCallback((C,p)=>{const y=n+1;f(C?l=>({...l,correct:l.correct+1}):l=>({...l,incorrect:l.incorrect+1,mistakes:[...l.mistakes,{realCard:d[n],displayedCard:o[n],userAction:p,wasCorrectPairing:S[`${n}-${d[n].id}`]}]})),y>=d.length?j("finished"):c(y)},[n,d]),z=s.useCallback(()=>o.slice(n,n+4),[o,n]);return{gameState:x,currentCard:o[n],realCard:d[n],cardStack:z(),currentIndex:n,totalCards:d.length,stats:g,handleSwipe:k,correctAnswer:d[n]?S[`${n}-${d[n].id}`]:null}}function H({card:a,index:u,isActive:x,onSwipe:j,correctAnswer:n}){const[c,d]=s.useState(null),[b,S]=s.useState(0),[r,o]=s.useState(!1),[i,g]=s.useState(0),[f,k]=s.useState(0),[z,C]=s.useState(1),[p,y]=s.useState(0);if(!a)return null;const l=t=>{!x||c||(o(!0),S(t.touches?t.touches[0].clientX:t.clientX))},m=t=>{if(!x||c||!r)return;const h=(t.touches?t.touches[0].clientX:t.clientX)-b;Math.abs(h)>20&&(g(h/150*15),k(h))},v=async()=>{if(!x)return;o(!1);const t=80,N=f<-t,h=f>t;N||h?await w(h):(g(0),k(0))},I=async t=>{!x||c||await w(t)},w=async t=>{if(!x)return;const N=t===n;d(N?"correct":"incorrect"),y(1),await new Promise(h=>{setTimeout(()=>{y(0)},200),setTimeout(h,300)}),k(t?500:-500),g(t?45:-45),C(0),await new Promise(h=>setTimeout(h,300)),j(N,t?"right":"left")},R=()=>"var(--color-surface)",A=()=>c==="correct"?"rgba(16, 185, 129, 0.8)":c==="incorrect"?"rgba(239, 68, 68, 0.8)":"transparent",W=()=>100-u;return e.jsxs("div",{onTouchStart:l,onTouchMove:m,onTouchEnd:v,onMouseDown:l,onMouseMove:r?m:void 0,onMouseUp:v,onMouseLeave:r?v:void 0,style:{position:"absolute",left:"50%",top:"50%",transform:`
          translateX(calc(-50% + ${f}px))
          translateY(-50%)
          rotateZ(${i}deg)
        `,width:"90%",maxWidth:"420px",height:"580px",backgroundColor:R(),borderRadius:"32px",border:"1px solid var(--color-surface-light)",zIndex:W(),cursor:x&&!r?"grab":r?"grabbing":"default",transition:r?"none":"transform 0.05s ease-out",padding:"0",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"var(--color-text-primary)",opacity:z,userSelect:"none",overflow:"hidden",boxShadow:"0 24px 48px rgba(0,0,0,0.2)",touchAction:"none"},children:[c&&e.jsx("div",{style:{position:"absolute",inset:0,backgroundColor:A(),opacity:p,transition:"opacity 0.3s ease",pointerEvents:"none",zIndex:10,borderRadius:"32px"}}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",padding:"var(--spacing-8)",height:"100%",width:"100%"},children:[e.jsx("div",{style:{fontSize:"16px",color:"var(--color-text-secondary)",textAlign:"center",fontWeight:"600",letterSpacing:"0.5px",lineHeight:1.4},children:"Ist das Zeichen richtig zugeordnet?"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"var(--spacing-6)",flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[a.character&&e.jsx("div",{style:{fontSize:"140px",fontWeight:"700",lineHeight:.95,color:"var(--color-text-primary)"},children:a.character}),a.word&&e.jsx("div",{style:{fontSize:"48px",fontWeight:"700",textAlign:"center",lineHeight:1.1,color:"var(--color-text-primary)"},children:a.word})]}),a.romaji&&e.jsx("div",{style:{fontSize:"28px",color:"#ec4899",fontWeight:"700",letterSpacing:"0.5px",fontStyle:"italic",padding:"0 var(--spacing-4)",textAlign:"center"},children:a.romaji})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",gap:"var(--spacing-4)",opacity:c?0:1,transition:"opacity 0.2s ease",pointerEvents:c?"none":"auto"},children:[e.jsxs("button",{onClick:()=>I(!1),style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"var(--spacing-4) var(--spacing-3)",borderRadius:"20px",backgroundColor:"rgba(239, 68, 68, 0.15)",border:"2px solid rgba(239, 68, 68, 0.3)",color:"#ef4444",fontSize:"28px",fontWeight:"bold",cursor:"pointer",transition:"all 0.2s ease",lineHeight:1},onMouseEnter:t=>{t.target.style.backgroundColor="rgba(239, 68, 68, 0.25)",t.target.style.borderColor="rgba(239, 68, 68, 0.5)",t.target.style.transform="scale(1.05)"},onMouseLeave:t=>{t.target.style.backgroundColor="rgba(239, 68, 68, 0.15)",t.target.style.borderColor="rgba(239, 68, 68, 0.3)",t.target.style.transform="scale(1)"},children:["‚Üê",e.jsx("span",{style:{fontSize:"12px",fontWeight:"700",letterSpacing:"0.5px",marginTop:"2px"},children:"Falsch"})]}),e.jsxs("button",{onClick:()=>I(!0),style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"var(--spacing-4) var(--spacing-3)",borderRadius:"20px",backgroundColor:"rgba(236, 72, 153, 0.2)",border:"2px solid rgba(236, 72, 153, 0.4)",color:"#ec4899",fontSize:"28px",fontWeight:"bold",cursor:"pointer",transition:"all 0.2s ease",lineHeight:1},onMouseEnter:t=>{t.target.style.backgroundColor="rgba(236, 72, 153, 0.3)",t.target.style.borderColor="rgba(236, 72, 153, 0.6)",t.target.style.transform="scale(1.05)"},onMouseLeave:t=>{t.target.style.backgroundColor="rgba(236, 72, 153, 0.2)",t.target.style.borderColor="rgba(236, 72, 153, 0.4)",t.target.style.transform="scale(1)"},children:["‚Üí",e.jsx("span",{style:{fontSize:"12px",fontWeight:"700",letterSpacing:"0.5px",marginTop:"2px"},children:"Richtig"})]})]})]})]})}function T({contentType:a,groupId:u,cardCount:x}){E();const[j,n]=s.useState([]),[c,d]=s.useState(!0),[b,S]=s.useState(null),r=G(j,x);if(s.useEffect(()=>{(async()=>{try{let i;u==="all"?i=await $(a):i=await X(a,u),n(i.items||[])}catch(i){S(i.message),console.error("Failed to load game data:",i)}finally{d(!1)}})()},[a,u]),c)return e.jsx(D,{children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx("p",{style:{color:"var(--color-text-tertiary)"},children:"Spiel wird vorbereitet..."})})});if(b)return e.jsx(D,{children:e.jsxs("div",{style:{padding:"var(--spacing-4)",backgroundColor:"#fee2e2",borderRadius:"var(--radius-md)",color:"#991b1b"},children:["Fehler: ",b]})});if(r.gameState==="finished"){const o=r.stats.correct+r.stats.incorrect,i=o>0?Math.round(r.stats.correct/o*100):0;return e.jsx(D,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(M,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:"0 0 var(--spacing-4) 0"},children:"Spiel beendet! üéâ"}),e.jsxs("div",{className:"grid-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"#10b981",margin:"0"},children:[r.stats.correct,"/",o]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Prozentsatz"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"var(--color-primary)",margin:"0"},children:[i,"%"]})]})]})]})}),r.stats.mistakes.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-medium text-primary",style:{marginBottom:"var(--spacing-3)"},children:["Fehler (",r.stats.mistakes.length,")"]}),e.jsx("div",{className:"space-y-3",children:r.stats.mistakes.map((g,f)=>e.jsx(M,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-3)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("p",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:0},children:g.realCard?.character||g.realCard?.word||"?"}),e.jsx("span",{style:{fontSize:"24px"},children:"‚ùå"})]}),e.jsxs("div",{style:{padding:"var(--spacing-2) var(--spacing-3)",backgroundColor:"var(--color-surface-light)",borderRadius:"var(--radius-md)"},children:[e.jsx("p",{className:"text-xs text-tertiary",style:{margin:"0 0 var(--spacing-1) 0"},children:"Gezeigt:"}),e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)",margin:0},children:g.displayedCard?.romaji||"?"})]}),e.jsxs("div",{style:{padding:"var(--spacing-2) var(--spacing-3)",backgroundColor:"rgba(16, 185, 129, 0.1)",borderRadius:"var(--radius-md)",border:"1px solid #10b981"},children:[e.jsx("p",{className:"text-xs text-tertiary",style:{margin:"0 0 var(--spacing-1) 0"},children:"Korrekt:"}),e.jsx("p",{className:"text-sm font-medium",style:{color:"#10b981",margin:0},children:g.realCard?.romaji||"?"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-2)",fontSize:"12px",color:"var(--color-text-tertiary)"},children:[e.jsxs("span",{children:["Du: ",g.userAction==="right"?"‚û°Ô∏è Richtig":"‚¨ÖÔ∏è Falsch"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{children:g.wasCorrectPairing?"War korrekt":"War falsch"})]})]})},f))})]})]})})}return e.jsxs(D,{children:[e.jsx("div",{style:{position:"relative",height:"600px",marginBottom:"var(--spacing-6)"},children:r.cardStack.map((o,i)=>e.jsx(H,{card:o,index:i,isActive:i===0,onSwipe:r.handleSwipe,correctAnswer:i===0?r.correctAnswer:void 0},`${r.currentIndex+i}`))}),e.jsx(M,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-3)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{className:"text-sm font-medium text-primary",children:["Karte ",r.currentIndex+1," / ",r.totalCards]}),e.jsxs("span",{style:{fontSize:"14px",fontWeight:"600",color:"var(--color-primary)"},children:[Math.round((r.currentIndex+1)/r.totalCards*100),"%"]})]}),e.jsx("div",{style:{width:"100%",backgroundColor:"var(--color-surface-light)",borderRadius:"9999px",height:"8px"},children:e.jsx("div",{style:{background:"linear-gradient(to right, var(--color-primary), var(--color-secondary))",height:"8px",borderRadius:"9999px",transition:"width 0.3s ease",width:`${(r.currentIndex+1)/r.totalCards*100}%`}})})]})}),e.jsx(M,{children:e.jsxs("div",{className:"grid-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"#10b981",margin:0},children:r.stats.correct})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Falsch"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"#ef4444",margin:0},children:r.stats.incorrect})]})]})}),e.jsx(F,{children:e.jsx("p",{className:"text-sm text-tertiary",style:{width:"100%",textAlign:"center",margin:0},children:"Wische ‚û°Ô∏è richtig | Wische ‚¨ÖÔ∏è falsch"})})]})}export{T as default};
