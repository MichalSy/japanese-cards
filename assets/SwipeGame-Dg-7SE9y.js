import{r as i,j as e,u as T,A as D,C as z,a as N,f as W,b as A}from"./index-Bnd2uPAA.js";function E(s,j){const[v,S]=i.useState("loading"),[n,d]=i.useState(0),[h,C]=i.useState([]),[w,o]=i.useState({}),[f,y]=i.useState([]),[b,u]=i.useState({correct:0,incorrect:0,mistakes:[]});i.useEffect(()=>{if(!s||s.length===0){S("error");return}const x=j==="all"?s.length:parseInt(j);let r=[];for(;r.length<x;){const g=x-r.length,k=[...s].sort(()=>Math.random()-.5).slice(0,g);r=[...r,...k]}const l={},c=[],R=[...Array(Math.ceil(r.length/2)).fill(!0),...Array(Math.floor(r.length/2)).fill(!1)].sort(()=>Math.random()-.5);r.forEach((g,k)=>{const t=R[k];if(t)c.push({...g,shownRomaji:g.romaji,correctRomaji:g.romaji,isWrongPairing:!1});else{let m,p=0;const I=20;do m=s[Math.floor(Math.random()*s.length)],p++;while(m.romaji===g.romaji&&p<I);m.romaji===g.romaji?c.push({...g,shownRomaji:g.romaji,correctRomaji:g.romaji,isWrongPairing:!1}):c.push({...g,shownRomaji:m.romaji,correctRomaji:g.romaji,isWrongPairing:!0})}l[`${k}-${g.id}`]=t}),C(r),y(c),o(l),S("playing")},[s,j]);const a=i.useCallback((x,r)=>{const l=n+1;u(x?c=>({...c,correct:c.correct+1}):c=>({...c,incorrect:c.incorrect+1,mistakes:[...c.mistakes,{realCard:h[n],displayedCard:f[n],userAction:r,wasCorrectPairing:w[`${n}-${h[n].id}`]}]})),l>=h.length?S("finished"):d(l)},[n,h]),M=i.useCallback(()=>f.slice(n,n+4),[f,n]);return{gameState:v,currentCard:f[n],realCard:h[n],cardStack:M(),currentIndex:n,totalCards:h.length,stats:b,handleSwipe:a,correctAnswer:h[n]?w[`${n}-${h[n].id}`]:null}}function $({card:s,index:j,isActive:v,onSwipe:S,correctAnswer:n}){const[d,h]=i.useState(null),[C,w]=i.useState(0),[o,f]=i.useState(!1),[y,b]=i.useState({x:0,rotation:0}),[u,a]=i.useState(null);if(!s)return null;const M=s.character||s.word||"",x=t=>{if(!v||d)return;t.preventDefault(),f(!0),h("swiping");const m=t.touches?t.touches[0].clientX:t.clientX;w(m)},r=t=>{if(!v||!o)return;t.preventDefault();const p=(t.touches?t.touches[0].clientX:t.clientX)-C,I=p/200*12;b({x:p,rotation:Math.max(-15,Math.min(15,I))})},l=()=>{if(!v||!o)return;f(!1);const t=100,m=y.x<-t,p=y.x>t;m||p?R(p):(h(null),b({x:0,rotation:0}))},c=t=>{!v||d==="exit"||R(t)},R=t=>{const m=t===n,p=t?"right":"left";a(p),h("exit"),b({x:p==="right"?400:-400,rotation:p==="right"?20:-20}),setTimeout(()=>{S(m,p,s.correctRomaji,M)},300)},g=()=>o?"none":d==="exit"?"transform 0.3s cubic-bezier(0.32, 0.72, 0, 1), opacity 0.3s ease-out":"transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1)",k=()=>d!=="exit"?"transparent":u==="right"===n?"rgba(16, 185, 129, 0.5)":"rgba(239, 68, 68, 0.5)";return e.jsxs("div",{onTouchStart:x,onTouchMove:r,onTouchEnd:l,onMouseDown:x,onMouseMove:o?r:void 0,onMouseUp:l,onMouseLeave:o?l:void 0,style:{position:"absolute",left:"50%",top:"50%",transform:`
          translateX(calc(-50% + ${y.x}px))
          translateY(-50%)
          rotate(${y.rotation}deg)
        `,transformOrigin:"center center",width:"92%",maxWidth:"380px",height:"460px",backgroundColor:"var(--color-surface)",borderRadius:"var(--radius-xl)",border:"1px solid var(--color-surface-light)",zIndex:100-j,cursor:v&&!o?"grab":o?"grabbing":"default",transition:g(),willChange:"transform, opacity",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"var(--color-text-primary)",opacity:d==="exit"?0:1,userSelect:"none",overflow:"hidden",boxShadow:o?"0 24px 48px rgba(0,0,0,0.35)":"0 16px 32px rgba(0,0,0,0.2)",touchAction:"none"},children:[e.jsx("div",{style:{position:"absolute",inset:0,backgroundColor:k(),opacity:d==="exit"?1:0,transition:"opacity 0.15s ease",pointerEvents:"none",zIndex:10,borderRadius:"var(--radius-xl)"}}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",left:"16px",top:"50%",transform:"translateY(-50%)",fontSize:"40px",opacity:Math.min(1,Math.max(0,-y.x/100)),transition:"opacity 0.1s",pointerEvents:"none"},children:"‚úó"}),e.jsx("div",{style:{position:"absolute",right:"16px",top:"50%",transform:"translateY(-50%)",fontSize:"40px",opacity:Math.min(1,Math.max(0,y.x/100)),transition:"opacity 0.1s",pointerEvents:"none"},children:"‚úì"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",padding:"var(--spacing-6)",height:"100%",width:"100%"},children:[e.jsx("div",{style:{fontSize:"14px",color:"var(--color-text-secondary)",textAlign:"center",fontWeight:"500",letterSpacing:"0.3px"},children:"Ist das Zeichen richtig zugeordnet?"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"var(--spacing-4)",flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[s.character&&e.jsx("div",{style:{fontSize:"110px",fontWeight:"700",lineHeight:1,color:"var(--color-text-primary)"},children:s.character}),s.word&&e.jsx("div",{style:{fontSize:"40px",fontWeight:"700",textAlign:"center",lineHeight:1.1,color:"var(--color-text-primary)"},children:s.word})]}),(s.shownRomaji||s.romaji)&&e.jsx("div",{style:{fontSize:"24px",color:"#ec4899",fontWeight:"700",letterSpacing:"0.5px",fontStyle:"italic"},children:s.shownRomaji||s.romaji})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",gap:"var(--spacing-3)",opacity:d==="exit"?0:1,transition:"opacity 0.15s"},children:[e.jsxs("button",{onClick:()=>c(!1),disabled:d==="exit",style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",padding:"var(--spacing-3) var(--spacing-2)",borderRadius:"var(--radius-lg)",backgroundColor:"rgba(239, 68, 68, 0.15)",border:"2px solid rgba(239, 68, 68, 0.3)",color:"#ef4444",fontSize:"24px",fontWeight:"bold",cursor:d==="exit"?"default":"pointer",transition:"all 0.2s ease",lineHeight:1},onMouseEnter:t=>{d!=="exit"&&(t.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.25)",t.currentTarget.style.borderColor="rgba(239, 68, 68, 0.5)",t.currentTarget.style.transform="scale(1.03)")},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.15)",t.currentTarget.style.borderColor="rgba(239, 68, 68, 0.3)",t.currentTarget.style.transform="scale(1)"},children:["‚Üê",e.jsx("span",{style:{fontSize:"11px",fontWeight:"600",letterSpacing:"0.3px"},children:"Falsch"})]}),e.jsxs("button",{onClick:()=>c(!0),disabled:d==="exit",style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",padding:"var(--spacing-3) var(--spacing-2)",borderRadius:"var(--radius-lg)",backgroundColor:"rgba(236, 72, 153, 0.2)",border:"2px solid rgba(236, 72, 153, 0.4)",color:"#ec4899",fontSize:"24px",fontWeight:"bold",cursor:d==="exit"?"default":"pointer",transition:"all 0.2s ease",lineHeight:1},onMouseEnter:t=>{d!=="exit"&&(t.currentTarget.style.backgroundColor="rgba(236, 72, 153, 0.3)",t.currentTarget.style.borderColor="rgba(236, 72, 153, 0.6)",t.currentTarget.style.transform="scale(1.03)")},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="rgba(236, 72, 153, 0.2)",t.currentTarget.style.borderColor="rgba(236, 72, 153, 0.4)",t.currentTarget.style.transform="scale(1)"},children:["‚Üí",e.jsx("span",{style:{fontSize:"11px",fontWeight:"600",letterSpacing:"0.3px"},children:"Richtig"})]})]})]})]})}function X({contentType:s,groupId:j,cardCount:v}){T();const[S,n]=i.useState([]),[d,h]=i.useState(!0),[C,w]=i.useState(null),[o,f]=i.useState(null),[y,b]=i.useState(!1),u=i.useRef(null),a=E(S,v),M=(x,r,l,c)=>{u.current&&(clearTimeout(u.current),u.current=null);const R={isCorrect:x,correctRomaji:l,character:c,id:Date.now()};f(R),b(!0),u.current=setTimeout(()=>{b(!1),u.current=setTimeout(()=>f(null),300)},1200),a.handleSwipe(x,r)};if(i.useEffect(()=>()=>{u.current&&clearTimeout(u.current)},[]),i.useEffect(()=>{(async()=>{try{let r;j==="all"?r=await W(s):r=await A(s,j),n(r.items||[])}catch(r){w(r.message),console.error("Failed to load game data:",r)}finally{h(!1)}})()},[s,j]),d)return e.jsx(D,{children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx("p",{style:{color:"var(--color-text-tertiary)"},children:"Spiel wird vorbereitet..."})})});if(C)return e.jsx(D,{children:e.jsxs("div",{style:{padding:"var(--spacing-4)",backgroundColor:"#fee2e2",borderRadius:"var(--radius-md)",color:"#991b1b"},children:["Fehler: ",C]})});if(a.gameState==="finished"){const x=a.stats.correct+a.stats.incorrect,r=x>0?Math.round(a.stats.correct/x*100):0;return e.jsx(D,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(z,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:"0 0 var(--spacing-4) 0"},children:"Spiel beendet! üéâ"}),e.jsxs("div",{className:"grid-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"#10b981",margin:"0"},children:[a.stats.correct,"/",x]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Prozentsatz"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"var(--color-primary)",margin:"0"},children:[r,"%"]})]})]})]})}),a.stats.mistakes.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-medium text-primary",style:{marginBottom:"var(--spacing-3)"},children:["Fehler (",a.stats.mistakes.length,")"]}),e.jsx("div",{className:"space-y-3",children:a.stats.mistakes.map((l,c)=>e.jsx(z,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-3)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("p",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:0},children:l.realCard?.character||l.realCard?.word||"?"}),e.jsx("span",{style:{fontSize:"24px"},children:"‚ùå"})]}),e.jsxs("div",{style:{padding:"var(--spacing-2) var(--spacing-3)",backgroundColor:"var(--color-surface-light)",borderRadius:"var(--radius-md)"},children:[e.jsx("p",{className:"text-xs text-tertiary",style:{margin:"0 0 var(--spacing-1) 0"},children:"Gezeigt:"}),e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)",margin:0},children:l.displayedCard?.romaji||"?"})]}),e.jsxs("div",{style:{padding:"var(--spacing-2) var(--spacing-3)",backgroundColor:"rgba(16, 185, 129, 0.1)",borderRadius:"var(--radius-md)",border:"1px solid #10b981"},children:[e.jsx("p",{className:"text-xs text-tertiary",style:{margin:"0 0 var(--spacing-1) 0"},children:"Korrekt:"}),e.jsx("p",{className:"text-sm font-medium",style:{color:"#10b981",margin:0},children:l.realCard?.romaji||"?"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-2)",fontSize:"12px",color:"var(--color-text-tertiary)"},children:[e.jsxs("span",{children:["Du: ",l.userAction==="right"?"‚û°Ô∏è Richtig":"‚¨ÖÔ∏è Falsch"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{children:l.wasCorrectPairing?"War korrekt":"War falsch"})]})]})},c))})]})]})})}return e.jsxs(D,{children:[o&&e.jsx("div",{style:{position:"fixed",top:"72px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,opacity:y?1:0,transition:"opacity 0.25s ease-out",pointerEvents:"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-2)",padding:"6px 12px",backgroundColor:o.isCorrect?"rgba(16, 185, 129, 0.95)":"rgba(239, 68, 68, 0.95)",borderRadius:"var(--radius-md)",boxShadow:"0 4px 16px rgba(0,0,0,0.25)"},children:[e.jsx("span",{style:{fontSize:"14px",color:"white"},children:o.isCorrect?"‚úì":"‚úó"}),e.jsx("span",{style:{fontSize:"14px",fontWeight:"600",color:"white"},children:o.isCorrect?"Richtig!":`${o.character||""} = ${o.correctRomaji}`})]})},o.id),e.jsx("div",{style:{position:"relative",height:"480px",marginBottom:"var(--spacing-4)",overflow:"hidden"},children:a.cardStack.map((x,r)=>e.jsx($,{card:x,index:r,isActive:r===0,onSwipe:M,correctAnswer:r===0?a.correctAnswer:void 0},`${a.currentIndex+r}`))}),e.jsx(z,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-3)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{className:"text-sm font-medium text-primary",children:["Karte ",a.currentIndex+1," / ",a.totalCards]}),e.jsxs("span",{style:{fontSize:"14px",fontWeight:"600",color:"var(--color-primary)"},children:[Math.round((a.currentIndex+1)/a.totalCards*100),"%"]})]}),e.jsx("div",{style:{width:"100%",backgroundColor:"var(--color-surface-light)",borderRadius:"9999px",height:"8px"},children:e.jsx("div",{style:{background:"linear-gradient(to right, var(--color-primary), var(--color-secondary))",height:"8px",borderRadius:"9999px",transition:"width 0.3s ease",width:`${(a.currentIndex+1)/a.totalCards*100}%`}})})]})}),e.jsx(z,{children:e.jsxs("div",{className:"grid-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"#10b981",margin:0},children:a.stats.correct})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Falsch"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"#ef4444",margin:0},children:a.stats.incorrect})]})]})}),e.jsx(N,{children:e.jsx("p",{className:"text-sm text-tertiary",style:{width:"100%",textAlign:"center",margin:0},children:"Wische ‚û°Ô∏è richtig | Wische ‚¨ÖÔ∏è falsch"})})]})}export{X as default};
