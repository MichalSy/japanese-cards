import{r as s,j as e,u as T,A as I,C as W,f as A,a as $}from"./index-Bp__puIL.js";function N(o,b){const[h,w]=s.useState("loading"),[l,p]=s.useState(0),[g,M]=s.useState([]),[z,c]=s.useState({}),[j,f]=s.useState([]),[C,m]=s.useState({correct:0,incorrect:0,mistakes:[]});s.useEffect(()=>{if(!o||o.length===0){w("error");return}const u=b==="all"?o.length:parseInt(b);let a=[];for(;a.length<u;){const r=u-a.length,x=[...o].sort(()=>Math.random()-.5).slice(0,r);a=[...a,...x]}const n={},d=[],v=[...Array(Math.ceil(a.length/2)).fill(!0),...Array(Math.floor(a.length/2)).fill(!1)].sort(()=>Math.random()-.5);a.forEach((r,x)=>{const R=v[x];if(R)d.push({...r,shownRomaji:r.romaji,correctRomaji:r.romaji,isWrongPairing:!1});else{let S,t=0;const y=20;do S=o[Math.floor(Math.random()*o.length)],t++;while(S.romaji===r.romaji&&t<y);S.romaji===r.romaji?d.push({...r,shownRomaji:r.romaji,correctRomaji:r.romaji,isWrongPairing:!1}):d.push({...r,shownRomaji:S.romaji,correctRomaji:r.romaji,isWrongPairing:!0})}n[`${x}-${r.id}`]=R}),M(a),f(d),c(n),w("playing")},[o,b]);const i=s.useCallback((u,a)=>{const n=l+1;m(u?d=>({...d,correct:d.correct+1}):d=>({...d,incorrect:d.incorrect+1,mistakes:[...d.mistakes,{realCard:g[l],displayedCard:j[l],userAction:a,wasCorrectPairing:z[`${l}-${g[l].id}`]}]})),n>=g.length?w("finished"):p(n)},[l,g]),k=s.useCallback(()=>j.slice(l,l+4),[j,l]);return{gameState:h,currentCard:j[l],realCard:g[l],cardStack:k(),currentIndex:l,totalCards:g.length,stats:C,handleSwipe:i,correctAnswer:g[l]?z[`${l}-${g[l].id}`]:null}}function L({card:o,index:b,isActive:h,onSwipe:w,correctAnswer:l}){const[p,g]=s.useState(null),[M,z]=s.useState(0),[c,j]=s.useState(!1),[f,C]=s.useState({x:0,rotation:0}),[m,i]=s.useState(null),k=o?.character||o?.word||"",u=s.useCallback(t=>{if(!o||p==="exit")return;const y=t===l,D=t?"right":"left";i(D),g("exit"),C({x:D==="right"?300:-300,rotation:D==="right"?10:-10}),setTimeout(()=>{w(y,D,o.correctRomaji,k)},220)},[o,l,w,k,p]);if(s.useEffect(()=>{if(!h||p||!o)return;const t=y=>{y.key==="ArrowLeft"?(y.preventDefault(),u(!1)):y.key==="ArrowRight"&&(y.preventDefault(),u(!0))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[h,p,o,u]),!o)return null;const a=t=>{if(!h||p)return;t.preventDefault(),j(!0),g("swiping");const y=t.touches?t.touches[0].clientX:t.clientX;z(y)},n=t=>{if(!h||!c)return;t.preventDefault();const D=(t.touches?t.touches[0].clientX:t.clientX)-M,E=D/300*6;C({x:D,rotation:Math.max(-8,Math.min(8,E))})},d=()=>{if(!h||!c)return;j(!1);const t=80;f.x<-t?u(!1):f.x>t?u(!0):(g(null),C({x:0,rotation:0}))},v=t=>{!h||p==="exit"||u(t)},r=()=>c?"none":p==="exit"?"all 0.22s ease-out":"all 0.28s cubic-bezier(0.34, 1.2, 0.64, 1)",x=Math.min(1,Math.abs(f.x)/50),R=f.x>0,S=f.x<0;return e.jsxs("div",{onTouchStart:a,onTouchMove:n,onTouchEnd:d,onMouseDown:a,onMouseMove:c?n:void 0,onMouseUp:d,onMouseLeave:c?d:void 0,style:{position:"absolute",left:"50%",top:"50%",transform:`
          translateX(calc(-50% + ${f.x}px))
          translateY(-50%)
          rotate(${f.rotation}deg)
        `,width:"calc(100% - 64px)",maxWidth:"340px",height:"calc(100% - 48px)",maxHeight:"500px",background:"var(--color-surface)",borderRadius:"16px",border:"1px solid var(--color-surface-light)",zIndex:100-b,cursor:h&&!c?"grab":c?"grabbing":"default",transition:r(),willChange:"transform, opacity",display:"flex",flexDirection:"column",opacity:p==="exit"?0:1,userSelect:"none",overflow:"hidden",touchAction:"none"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:0,bottom:0,width:"50%",background:`linear-gradient(90deg, rgba(239, 68, 68, ${S?x*.5:0}) 0%, transparent 100%)`,pointerEvents:"none",transition:c?"none":"background 0.2s",display:"flex",alignItems:"center",justifyContent:"flex-start",paddingLeft:"20px"},children:e.jsx("span",{style:{fontSize:"36px",opacity:S?x:0,transform:`scale(${.6+x*.4})`,transition:c?"none":"all 0.2s"},children:"âœ—"})}),e.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:"50%",background:`linear-gradient(-90deg, rgba(16, 185, 129, ${R?x*.5:0}) 0%, transparent 100%)`,pointerEvents:"none",transition:c?"none":"background 0.2s",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"20px"},children:e.jsx("span",{style:{fontSize:"36px",opacity:R?x:0,transform:`scale(${.5+x*.5})`,transition:c?"none":"all 0.2s"},children:"âœ“"})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,padding:"40px 24px",gap:"20px"},children:[e.jsx("div",{style:{fontSize:"clamp(100px, 28vw, 180px)",fontWeight:"200",lineHeight:1,color:"var(--color-text-primary)",textAlign:"center"},children:k}),(o.shownRomaji||o.romaji)&&e.jsx("div",{style:{fontSize:"28px",color:"var(--color-primary)",fontWeight:"500",letterSpacing:"3px",textTransform:"lowercase"},children:o.shownRomaji||o.romaji})]}),e.jsxs("div",{style:{display:"flex",padding:"20px 24px",paddingBottom:"28px",gap:"16px",opacity:p==="exit"?0:1},children:[e.jsx("button",{onClick:()=>v(!1),disabled:p==="exit",style:{flex:1,padding:"16px 20px",borderRadius:"100px",backgroundColor:"rgba(239, 68, 68, 0.08)",border:"none",color:"#f87171",fontSize:"15px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.15)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.08)"},children:"â† Falsch"}),e.jsx("button",{onClick:()=>v(!0),disabled:p==="exit",style:{flex:1,padding:"16px 20px",borderRadius:"100px",backgroundColor:"rgba(16, 185, 129, 0.08)",border:"none",color:"#34d399",fontSize:"15px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="rgba(16, 185, 129, 0.15)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="rgba(16, 185, 129, 0.08)"},children:"Richtig â†’"})]})]})}function B({contentType:o,groupId:b,cardCount:h}){T();const[w,l]=s.useState([]),[p,g]=s.useState(!0),[M,z]=s.useState(null),[c,j]=s.useState(null),[f,C]=s.useState(!1),m=s.useRef(null),i=N(w,h),k=(a,n,d,v)=>{m.current&&(clearTimeout(m.current),m.current=null);const r={isCorrect:a,correctRomaji:d,character:v,id:Date.now()};j(r),C(!0),m.current=setTimeout(()=>{C(!1),m.current=setTimeout(()=>j(null),300)},2500),i.handleSwipe(a,n)};if(s.useEffect(()=>()=>{m.current&&clearTimeout(m.current)},[]),s.useEffect(()=>{(async()=>{try{let n;b==="all"?n=await A(o):n=await $(o,b),l(n.items||[])}catch(n){z(n.message),console.error("Failed to load game data:",n)}finally{g(!1)}})()},[o,b]),p)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--color-text-tertiary)"},children:"Spiel wird vorbereitet..."});if(M)return e.jsx(I,{children:e.jsxs("div",{style:{padding:"var(--spacing-4)",backgroundColor:"rgba(239, 68, 68, 0.1)",borderRadius:"var(--radius-md)",color:"#ef4444",border:"1px solid rgba(239, 68, 68, 0.3)"},children:["Fehler: ",M]})});if(i.gameState==="finished"){const a=i.stats.correct+i.stats.incorrect,n=a>0?Math.round(i.stats.correct/a*100):0;return e.jsx(I,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(W,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:"0 0 var(--spacing-4) 0"},children:"Spiel beendet! ðŸŽ‰"}),e.jsxs("div",{className:"grid-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"#10b981",margin:"0"},children:[i.stats.correct,"/",a]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Prozentsatz"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"var(--color-primary)",margin:"0"},children:[n,"%"]})]})]})]})}),i.stats.mistakes.length>0&&(()=>{const d=[],v=new Set;return i.stats.mistakes.forEach(r=>{const x=r.realCard?.character||r.realCard?.word;x&&!v.has(x)&&(v.add(x),d.push(r))}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium",style:{color:"var(--color-text-secondary)",marginBottom:"var(--spacing-4)"},children:"ðŸ“š Nochmal Ã¼ben"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"12px"},children:d.map((r,x)=>{const R=r.realCard?.character||r.realCard?.word||"?",S=r.realCard?.romaji;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px 16px",backgroundColor:"var(--color-surface)",borderRadius:"16px",border:"1px solid var(--color-surface-light)"},children:[e.jsx("span",{style:{fontSize:"48px",fontWeight:"300",color:"var(--color-text-primary)",lineHeight:1,marginBottom:"8px"},children:R}),e.jsx("span",{style:{fontSize:"16px",color:"var(--color-primary)",fontWeight:"600"},children:S})]},x)})})]})})()]})})}const u=i.currentIndex/i.totalCards*100;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden",position:"relative"},children:[e.jsx("div",{style:{padding:"12px 16px",textAlign:"center",borderBottom:"1px solid var(--color-surface-light)",backgroundColor:"var(--color-bg-secondary)"},children:e.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:"var(--color-text-secondary)",letterSpacing:"0.3px"},children:"Ist die Kombination richtig?"})}),c&&e.jsx("div",{style:{position:"absolute",top:"60px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,opacity:f?1:0,transition:"opacity 0.3s ease-out",pointerEvents:"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 20px",backgroundColor:c.isCorrect?"#10b981":"#ef4444",borderRadius:"12px",boxShadow:"0 4px 20px rgba(0,0,0,0.25)"},children:[e.jsx("span",{style:{fontSize:"20px",fontWeight:"bold",color:"white"},children:c.isCorrect?"âœ“":"âœ—"}),e.jsxs("span",{style:{fontSize:"17px",fontWeight:"600",color:"white",letterSpacing:"0.5px"},children:[c.character," = ",c.correctRomaji]})]})},c.id),e.jsx("div",{style:{flex:1,position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"16px",minHeight:0},children:i.cardStack.map((a,n)=>e.jsx(L,{card:a,index:n,isActive:n===0,onSwipe:k,correctAnswer:n===0?i.correctAnswer:void 0},`${i.currentIndex+n}`))}),e.jsxs("div",{style:{padding:"12px 16px",paddingBottom:"max(12px, env(safe-area-inset-bottom))",backgroundColor:"var(--color-surface)",borderTop:"1px solid var(--color-surface-light)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px"},children:[e.jsx("div",{style:{flex:1,height:"6px",backgroundColor:"var(--color-surface-light)",borderRadius:"3px",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${u}%`,background:"linear-gradient(90deg, var(--color-primary), var(--color-secondary))",borderRadius:"3px",transition:"width 0.3s ease"}})}),e.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:"var(--color-text-secondary)",minWidth:"60px",textAlign:"right"},children:[i.currentIndex+1," / ",i.totalCards]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"24px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{style:{fontSize:"13px",color:"var(--color-text-tertiary)"},children:"Richtig:"}),e.jsx("span",{style:{fontSize:"15px",fontWeight:"700",color:"#10b981"},children:i.stats.correct})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{style:{fontSize:"13px",color:"var(--color-text-tertiary)"},children:"Falsch:"}),e.jsx("span",{style:{fontSize:"15px",fontWeight:"700",color:"#ef4444"},children:i.stats.incorrect})]})]})]})]})}export{B as default};
