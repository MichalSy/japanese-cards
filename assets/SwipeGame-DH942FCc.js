import{r as a,j as e,A as E,C as M,f as T,a as W}from"./index-DfoEO0DX.js";import{u as L}from"./useSwipeGame-D8ZNzoBq.js";function N({card:s,index:v,isActive:d,onSwipe:w,correctAnswer:C}){const[l,j]=a.useState(null),[k,z]=a.useState(0),[n,S]=a.useState(!1),[x,y]=a.useState({x:0,rotation:0}),[,p]=a.useState(null),r=s?.character||s?.word||"",u=a.useCallback(t=>{if(!s||l==="exit")return;const g=t===C,m=t?"right":"left";p(m),j("exit"),y({x:m==="right"?300:-300,rotation:m==="right"?10:-10}),setTimeout(()=>{w(g,m,s.correctRomaji,r)},220)},[s,C,w,r,l]);if(a.useEffect(()=>{if(!d||l||!s)return;const t=g=>{g.key==="ArrowLeft"?(g.preventDefault(),u(!1)):g.key==="ArrowRight"&&(g.preventDefault(),u(!0))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[d,l,s,u]),!s)return null;const D=t=>{if(!d||l)return;t.preventDefault(),S(!0),j("swiping");const g=t.touches?t.touches[0].clientX:t.clientX;z(g)},c=t=>{if(!d||!n)return;t.preventDefault();const m=(t.touches?t.touches[0].clientX:t.clientX)-k,I=m/300*6;y({x:m,rotation:Math.max(-8,Math.min(8,I))})},o=()=>{if(!d||!n)return;S(!1);const t=80;x.x<-t?u(!1):x.x>t?u(!0):(j(null),y({x:0,rotation:0}))},f=t=>{!d||l==="exit"||u(t)},b=()=>n?"none":l==="exit"?"all 0.22s ease-out":"all 0.28s cubic-bezier(0.34, 1.2, 0.64, 1)",i=Math.min(1,Math.abs(x.x)/50),h=x.x>0,R=x.x<0;return e.jsxs("div",{onTouchStart:D,onTouchMove:c,onTouchEnd:o,onMouseDown:D,onMouseMove:n?c:void 0,onMouseUp:o,onMouseLeave:n?o:void 0,style:{position:"absolute",left:"50%",top:"50%",transform:`
          translateX(calc(-50% + ${x.x}px))
          translateY(-50%)
          rotate(${x.rotation}deg)
        `,width:"calc(100% - 64px)",maxWidth:"340px",height:"calc(100% - 48px)",maxHeight:"500px",background:"var(--color-surface)",borderRadius:"16px",border:"1px solid var(--color-surface-light)",zIndex:100-v,cursor:d&&!n?"grab":n?"grabbing":"default",transition:b(),willChange:"transform, opacity",display:"flex",flexDirection:"column",opacity:l==="exit"?0:1,userSelect:"none",overflow:"hidden",touchAction:"none"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:0,bottom:0,width:"50%",background:`linear-gradient(90deg, rgba(239, 68, 68, ${R?i*.5:0}) 0%, transparent 100%)`,pointerEvents:"none",transition:n?"none":"background 0.2s",display:"flex",alignItems:"center",justifyContent:"flex-start",paddingLeft:"20px"},children:e.jsx("span",{style:{fontSize:"36px",opacity:R?i:0,transform:`scale(${.6+i*.4})`,transition:n?"none":"all 0.2s"},children:"âœ—"})}),e.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:"50%",background:`linear-gradient(-90deg, rgba(16, 185, 129, ${h?i*.5:0}) 0%, transparent 100%)`,pointerEvents:"none",transition:n?"none":"background 0.2s",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"20px"},children:e.jsx("span",{style:{fontSize:"36px",opacity:h?i:0,transform:`scale(${.5+i*.5})`,transition:n?"none":"all 0.2s"},children:"âœ“"})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,padding:"40px 24px",gap:"20px"},children:[e.jsx("div",{style:{fontSize:"clamp(100px, 28vw, 180px)",fontWeight:"200",lineHeight:1,color:"var(--color-text-primary)",textAlign:"center"},children:r}),(s.shownRomaji||s.romaji)&&e.jsx("div",{style:{fontSize:"28px",color:"var(--color-primary)",fontWeight:"500",letterSpacing:"3px",textTransform:"lowercase"},children:s.shownRomaji||s.romaji})]}),e.jsxs("div",{style:{display:"flex",padding:"20px 24px",paddingBottom:"28px",gap:"16px",opacity:l==="exit"?0:1},children:[e.jsx("button",{onClick:()=>f(!1),disabled:l==="exit",style:{flex:1,padding:"16px 20px",borderRadius:"100px",backgroundColor:"rgba(239, 68, 68, 0.08)",border:"none",color:"#f87171",fontSize:"15px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.15)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.08)"},children:"â† Falsch"}),e.jsx("button",{onClick:()=>f(!0),disabled:l==="exit",style:{flex:1,padding:"16px 20px",borderRadius:"100px",backgroundColor:"rgba(16, 185, 129, 0.08)",border:"none",color:"#34d399",fontSize:"15px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="rgba(16, 185, 129, 0.15)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="rgba(16, 185, 129, 0.08)"},children:"Richtig â†’"})]})]})}function B({contentType:s,groupId:v,cardCount:d}){const[w,C]=a.useState([]),[l,j]=a.useState(!0),[k,z]=a.useState(null),[n,S]=a.useState(null),[x,y]=a.useState(!1),p=a.useRef(null),r=L(w,d,s),u=(c,o,f,b)=>{p.current&&(clearTimeout(p.current),p.current=null);const i={isCorrect:c,correctRomaji:f,character:b,id:Date.now()};S(i),y(!0),p.current=setTimeout(()=>{y(!1),p.current=setTimeout(()=>S(null),300)},2500),r.handleSwipe(c,o)};if(a.useEffect(()=>()=>{p.current&&clearTimeout(p.current)},[]),a.useEffect(()=>{(async()=>{try{let o;v==="all"?o=await T(s):o=await W(s,v),C(o.items||[])}catch(o){z(o.message),console.error("Failed to load game data:",o)}finally{j(!1)}})()},[s,v]),l)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--color-text-tertiary)"},children:"Spiel wird vorbereitet..."});if(k)return e.jsx(E,{children:e.jsxs("div",{style:{padding:"var(--spacing-4)",backgroundColor:"rgba(239, 68, 68, 0.1)",borderRadius:"var(--radius-md)",color:"#ef4444",border:"1px solid rgba(239, 68, 68, 0.3)"},children:["Fehler: ",k]})});if(r.gameState==="finished"){const c=r.stats.correct+r.stats.incorrect,o=c>0?Math.round(r.stats.correct/c*100):0;return e.jsx(E,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(M,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:"0 0 var(--spacing-4) 0"},children:"Spiel beendet! ðŸŽ‰"}),e.jsxs("div",{className:"grid-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"#10b981",margin:"0"},children:[r.stats.correct,"/",c]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Prozentsatz"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"var(--color-primary)",margin:"0"},children:[o,"%"]})]})]})]})}),r.stats.mistakes.length>0&&(()=>{const f=[],b=new Set;return r.stats.mistakes.forEach(i=>{const h=i.realCard?.character||i.realCard?.word;h&&!b.has(h)&&(b.add(h),f.push(i))}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium",style:{color:"var(--color-text-secondary)",marginBottom:"var(--spacing-4)"},children:"ðŸ“š Nochmal Ã¼ben"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"12px"},children:f.map((i,h)=>{const R=i.realCard?.character||i.realCard?.word||"?",t=i.realCard?.romaji;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px 16px",backgroundColor:"var(--color-surface)",borderRadius:"16px",border:"1px solid var(--color-surface-light)"},children:[e.jsx("span",{style:{fontSize:"48px",fontWeight:"300",color:"var(--color-text-primary)",lineHeight:1,marginBottom:"8px"},children:R}),e.jsx("span",{style:{fontSize:"16px",color:"var(--color-primary)",fontWeight:"600"},children:t})]},h)})})]})})()]})})}const D=r.currentIndex/r.totalCards*100;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden",position:"relative"},children:[e.jsx("div",{style:{padding:"12px 16px",textAlign:"center",borderBottom:"1px solid var(--color-surface-light)",backgroundColor:"var(--color-bg-secondary)"},children:e.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:"var(--color-text-secondary)",letterSpacing:"0.3px"},children:"Ist die Kombination richtig?"})}),n&&e.jsx("div",{style:{position:"absolute",top:"60px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,opacity:x?1:0,transition:"opacity 0.3s ease-out",pointerEvents:"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 20px",backgroundColor:n.isCorrect?"#10b981":"#ef4444",borderRadius:"12px",boxShadow:"0 4px 20px rgba(0,0,0,0.25)"},children:[e.jsx("span",{style:{fontSize:"20px",fontWeight:"bold",color:"white"},children:n.isCorrect?"âœ“":"âœ—"}),e.jsxs("span",{style:{fontSize:"17px",fontWeight:"600",color:"white",letterSpacing:"0.5px"},children:[n.character," = ",n.correctRomaji]})]})},n.id),e.jsx("div",{style:{flex:1,position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"16px",minHeight:0},children:r.cardStack.map((c,o)=>e.jsx(N,{card:c,index:o,isActive:o===0,onSwipe:u,correctAnswer:o===0?r.correctAnswer:void 0},`${r.currentIndex+o}`))}),e.jsxs("div",{style:{padding:"12px 16px",paddingBottom:"max(12px, env(safe-area-inset-bottom))",backgroundColor:"var(--color-surface)",borderTop:"1px solid var(--color-surface-light)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px"},children:[e.jsx("div",{style:{flex:1,height:"6px",backgroundColor:"var(--color-surface-light)",borderRadius:"3px",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${D}%`,background:"linear-gradient(90deg, var(--color-primary), var(--color-secondary))",borderRadius:"3px",transition:"width 0.3s ease"}})}),e.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:"var(--color-text-secondary)",minWidth:"60px",textAlign:"right"},children:[r.currentIndex+1," / ",r.totalCards]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"24px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{style:{fontSize:"13px",color:"var(--color-text-tertiary)"},children:"Richtig:"}),e.jsx("span",{style:{fontSize:"15px",fontWeight:"700",color:"#10b981"},children:r.stats.correct})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{style:{fontSize:"13px",color:"var(--color-text-tertiary)"},children:"Falsch:"}),e.jsx("span",{style:{fontSize:"15px",fontWeight:"700",color:"#ef4444"},children:r.stats.incorrect})]})]})]})]})}export{B as default};
