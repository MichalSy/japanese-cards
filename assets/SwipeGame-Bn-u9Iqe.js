import{r as s,j as t,u as W,A as I,C as A,f as E,a as $}from"./index-Bq4N-HeR.js";function N(i,y){const[j,w]=s.useState("loading"),[c,g]=s.useState(0),[p,R]=s.useState([]),[M,l]=s.useState({}),[f,h]=s.useState([]),[S,u]=s.useState({correct:0,incorrect:0,mistakes:[]});s.useEffect(()=>{if(!i||i.length===0){w("error");return}const b=y==="all"?i.length:parseInt(y);let n=[];for(;n.length<b;){const o=b-n.length,x=[...i].sort(()=>Math.random()-.5).slice(0,o);n=[...n,...x]}const r={},d=[],m=[...Array(Math.ceil(n.length/2)).fill(!0),...Array(Math.floor(n.length/2)).fill(!1)].sort(()=>Math.random()-.5);n.forEach((o,x)=>{const C=m[x];if(C)d.push({...o,shownRomaji:o.romaji,correctRomaji:o.romaji,isWrongPairing:!1});else{let v,e=0;const D=20;do v=i[Math.floor(Math.random()*i.length)],e++;while(v.romaji===o.romaji&&e<D);v.romaji===o.romaji?d.push({...o,shownRomaji:o.romaji,correctRomaji:o.romaji,isWrongPairing:!1}):d.push({...o,shownRomaji:v.romaji,correctRomaji:o.romaji,isWrongPairing:!0})}r[`${x}-${o.id}`]=C}),R(n),h(d),l(r),w("playing")},[i,y]);const a=s.useCallback((b,n)=>{const r=c+1;u(b?d=>({...d,correct:d.correct+1}):d=>({...d,incorrect:d.incorrect+1,mistakes:[...d.mistakes,{realCard:p[c],displayedCard:f[c],userAction:n,wasCorrectPairing:M[`${c}-${p[c].id}`]}]})),r>=p.length?w("finished"):g(r)},[c,p]),z=s.useCallback(()=>f.slice(c,c+4),[f,c]);return{gameState:j,currentCard:f[c],realCard:p[c],cardStack:z(),currentIndex:c,totalCards:p.length,stats:S,handleSwipe:a,correctAnswer:p[c]?M[`${c}-${p[c].id}`]:null}}function X({card:i,index:y,isActive:j,onSwipe:w,correctAnswer:c}){const[g,p]=s.useState(null),[R,M]=s.useState(0),[l,f]=s.useState(!1),[h,S]=s.useState({x:0,rotation:0}),[u,a]=s.useState(null);if(!i)return null;const z=i.character||i.word||"",b=e=>{if(!j||g)return;e.preventDefault(),f(!0),p("swiping");const D=e.touches?e.touches[0].clientX:e.clientX;M(D)},n=e=>{if(!j||!l)return;e.preventDefault();const k=(e.touches?e.touches[0].clientX:e.clientX)-R,T=k/300*6;S({x:k,rotation:Math.max(-8,Math.min(8,T))})},r=()=>{if(!j||!l)return;f(!1);const e=80;h.x<-e?m(!1):h.x>e?m(!0):(p(null),S({x:0,rotation:0}))},d=e=>{!j||g==="exit"||m(e)},m=e=>{const D=e===c,k=e?"right":"left";a(k),p("exit"),S({x:k==="right"?300:-300,rotation:k==="right"?10:-10}),setTimeout(()=>{w(D,k,i.correctRomaji,z)},220)},o=()=>l?"none":g==="exit"?"all 0.22s ease-out":"all 0.28s cubic-bezier(0.34, 1.2, 0.64, 1)",x=Math.min(1,Math.abs(h.x)/50),C=h.x>0,v=h.x<0;return t.jsxs("div",{onTouchStart:b,onTouchMove:n,onTouchEnd:r,onMouseDown:b,onMouseMove:l?n:void 0,onMouseUp:r,onMouseLeave:l?r:void 0,style:{position:"absolute",left:"50%",top:"50%",transform:`
          translateX(calc(-50% + ${h.x}px))
          translateY(-50%)
          rotate(${h.rotation}deg)
        `,width:"calc(100% - 64px)",maxWidth:"340px",height:"calc(100% - 48px)",maxHeight:"500px",background:"var(--color-surface)",borderRadius:"16px",border:"1px solid var(--color-surface-light)",zIndex:100-y,cursor:j&&!l?"grab":l?"grabbing":"default",transition:o(),willChange:"transform, opacity",display:"flex",flexDirection:"column",opacity:g==="exit"?0:1,userSelect:"none",overflow:"hidden",touchAction:"none"},children:[t.jsx("div",{style:{position:"absolute",left:0,top:0,bottom:0,width:"50%",background:`linear-gradient(90deg, rgba(239, 68, 68, ${v?x*.5:0}) 0%, transparent 100%)`,pointerEvents:"none",transition:l?"none":"background 0.2s",display:"flex",alignItems:"center",justifyContent:"flex-start",paddingLeft:"20px"},children:t.jsx("span",{style:{fontSize:"36px",opacity:v?x:0,transform:`scale(${.6+x*.4})`,transition:l?"none":"all 0.2s"},children:"âœ—"})}),t.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:"50%",background:`linear-gradient(-90deg, rgba(16, 185, 129, ${C?x*.5:0}) 0%, transparent 100%)`,pointerEvents:"none",transition:l?"none":"background 0.2s",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"20px"},children:t.jsx("span",{style:{fontSize:"36px",opacity:C?x:0,transform:`scale(${.5+x*.5})`,transition:l?"none":"all 0.2s"},children:"âœ“"})}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,padding:"40px 24px",gap:"20px"},children:[t.jsx("div",{style:{fontSize:"clamp(100px, 28vw, 180px)",fontWeight:"200",lineHeight:1,color:"var(--color-text-primary)",textAlign:"center"},children:z}),(i.shownRomaji||i.romaji)&&t.jsx("div",{style:{fontSize:"28px",color:"var(--color-primary)",fontWeight:"500",letterSpacing:"3px",textTransform:"lowercase"},children:i.shownRomaji||i.romaji})]}),t.jsxs("div",{style:{display:"flex",padding:"20px 24px",paddingBottom:"28px",gap:"16px",opacity:g==="exit"?0:1},children:[t.jsx("button",{onClick:()=>d(!1),disabled:g==="exit",style:{flex:1,padding:"16px 20px",borderRadius:"100px",backgroundColor:"rgba(239, 68, 68, 0.08)",border:"none",color:"#f87171",fontSize:"15px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.15)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.08)"},children:"Falsch"}),t.jsx("button",{onClick:()=>d(!0),disabled:g==="exit",style:{flex:1,padding:"16px 20px",borderRadius:"100px",backgroundColor:"rgba(16, 185, 129, 0.08)",border:"none",color:"#34d399",fontSize:"15px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="rgba(16, 185, 129, 0.15)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="rgba(16, 185, 129, 0.08)"},children:"Richtig"})]})]})}function P({contentType:i,groupId:y,cardCount:j}){W();const[w,c]=s.useState([]),[g,p]=s.useState(!0),[R,M]=s.useState(null),[l,f]=s.useState(null),[h,S]=s.useState(!1),u=s.useRef(null),a=N(w,j),z=(n,r,d,m)=>{u.current&&(clearTimeout(u.current),u.current=null);const o={isCorrect:n,correctRomaji:d,character:m,id:Date.now()};f(o),S(!0),u.current=setTimeout(()=>{S(!1),u.current=setTimeout(()=>f(null),300)},2500),a.handleSwipe(n,r)};if(s.useEffect(()=>()=>{u.current&&clearTimeout(u.current)},[]),s.useEffect(()=>{(async()=>{try{let r;y==="all"?r=await E(i):r=await $(i,y),c(r.items||[])}catch(r){M(r.message),console.error("Failed to load game data:",r)}finally{p(!1)}})()},[i,y]),g)return t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--color-text-tertiary)"},children:"Spiel wird vorbereitet..."});if(R)return t.jsx(I,{children:t.jsxs("div",{style:{padding:"var(--spacing-4)",backgroundColor:"rgba(239, 68, 68, 0.1)",borderRadius:"var(--radius-md)",color:"#ef4444",border:"1px solid rgba(239, 68, 68, 0.3)"},children:["Fehler: ",R]})});if(a.gameState==="finished"){const n=a.stats.correct+a.stats.incorrect,r=n>0?Math.round(a.stats.correct/n*100):0;return t.jsx(I,{children:t.jsxs("div",{className:"space-y-6",children:[t.jsx(A,{children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:"0 0 var(--spacing-4) 0"},children:"Spiel beendet! ðŸŽ‰"}),t.jsxs("div",{className:"grid-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),t.jsxs("p",{className:"text-3xl font-bold",style:{color:"#10b981",margin:"0"},children:[a.stats.correct,"/",n]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Prozentsatz"}),t.jsxs("p",{className:"text-3xl font-bold",style:{color:"var(--color-primary)",margin:"0"},children:[r,"%"]})]})]})]})}),a.stats.mistakes.length>0&&(()=>{const d=[],m=new Set;return a.stats.mistakes.forEach(o=>{const x=o.realCard?.character||o.realCard?.word;x&&!m.has(x)&&(m.add(x),d.push(o))}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-medium",style:{color:"var(--color-text-secondary)",marginBottom:"var(--spacing-4)"},children:"ðŸ“š Nochmal Ã¼ben"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"12px"},children:d.map((o,x)=>{const C=o.realCard?.character||o.realCard?.word||"?",v=o.realCard?.romaji;return t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px 16px",backgroundColor:"var(--color-surface)",borderRadius:"16px",border:"1px solid var(--color-surface-light)"},children:[t.jsx("span",{style:{fontSize:"48px",fontWeight:"300",color:"var(--color-text-primary)",lineHeight:1,marginBottom:"8px"},children:C}),t.jsx("span",{style:{fontSize:"16px",color:"var(--color-primary)",fontWeight:"600"},children:v})]},x)})})]})})()]})})}const b=a.currentIndex/a.totalCards*100;return t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden",position:"relative"},children:[t.jsx("div",{style:{padding:"12px 16px",textAlign:"center",borderBottom:"1px solid var(--color-surface-light)",backgroundColor:"var(--color-bg-secondary)"},children:t.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:"var(--color-text-secondary)",letterSpacing:"0.3px"},children:"Ist die Kombination richtig?"})}),l&&t.jsx("div",{style:{position:"absolute",top:"60px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,opacity:h?1:0,transition:"opacity 0.3s ease-out",pointerEvents:"none"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 20px",backgroundColor:l.isCorrect?"#10b981":"#ef4444",borderRadius:"12px",boxShadow:"0 4px 20px rgba(0,0,0,0.25)"},children:[t.jsx("span",{style:{fontSize:"20px",fontWeight:"bold",color:"white"},children:l.isCorrect?"âœ“":"âœ—"}),t.jsxs("span",{style:{fontSize:"17px",fontWeight:"600",color:"white",letterSpacing:"0.5px"},children:[l.character," = ",l.correctRomaji]})]})},l.id),t.jsx("div",{style:{flex:1,position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"16px",minHeight:0},children:a.cardStack.map((n,r)=>t.jsx(X,{card:n,index:r,isActive:r===0,onSwipe:z,correctAnswer:r===0?a.correctAnswer:void 0},`${a.currentIndex+r}`))}),t.jsxs("div",{style:{padding:"12px 16px",paddingBottom:"max(12px, env(safe-area-inset-bottom))",backgroundColor:"var(--color-surface)",borderTop:"1px solid var(--color-surface-light)"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px"},children:[t.jsx("div",{style:{flex:1,height:"6px",backgroundColor:"var(--color-surface-light)",borderRadius:"3px",overflow:"hidden"},children:t.jsx("div",{style:{height:"100%",width:`${b}%`,background:"linear-gradient(90deg, var(--color-primary), var(--color-secondary))",borderRadius:"3px",transition:"width 0.3s ease"}})}),t.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:"var(--color-text-secondary)",minWidth:"60px",textAlign:"right"},children:[a.currentIndex+1," / ",a.totalCards]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"24px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{style:{fontSize:"13px",color:"var(--color-text-tertiary)"},children:"Richtig:"}),t.jsx("span",{style:{fontSize:"15px",fontWeight:"700",color:"#10b981"},children:a.stats.correct})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{style:{fontSize:"13px",color:"var(--color-text-tertiary)"},children:"Falsch:"}),t.jsx("span",{style:{fontSize:"15px",fontWeight:"700",color:"#ef4444"},children:a.stats.incorrect})]})]})]})]})}export{P as default};
