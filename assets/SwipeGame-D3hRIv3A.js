import{r as i,j as t,u as T,A as W,C as I,f as E,a as $}from"./index-DdLdLUFi.js";function N(a,y){const[j,w]=i.useState("loading"),[d,h]=i.useState(0),[x,k]=i.useState([]),[z,l]=i.useState({}),[m,u]=i.useState([]),[S,f]=i.useState({correct:0,incorrect:0,mistakes:[]});i.useEffect(()=>{if(!a||a.length===0){w("error");return}const v=y==="all"?a.length:parseInt(y);let s=[];for(;s.length<v;){const c=v-s.length,p=[...a].sort(()=>Math.random()-.5).slice(0,c);s=[...s,...p]}const r={},o=[],b=[...Array(Math.ceil(s.length/2)).fill(!0),...Array(Math.floor(s.length/2)).fill(!1)].sort(()=>Math.random()-.5);s.forEach((c,p)=>{const C=b[p];if(C)o.push({...c,shownRomaji:c.romaji,correctRomaji:c.romaji,isWrongPairing:!1});else{let g,e=0;const M=20;do g=a[Math.floor(Math.random()*a.length)],e++;while(g.romaji===c.romaji&&e<M);g.romaji===c.romaji?o.push({...c,shownRomaji:c.romaji,correctRomaji:c.romaji,isWrongPairing:!1}):o.push({...c,shownRomaji:g.romaji,correctRomaji:c.romaji,isWrongPairing:!0})}r[`${p}-${c.id}`]=C}),k(s),u(o),l(r),w("playing")},[a,y]);const n=i.useCallback((v,s)=>{const r=d+1;f(v?o=>({...o,correct:o.correct+1}):o=>({...o,incorrect:o.incorrect+1,mistakes:[...o.mistakes,{realCard:x[d],displayedCard:m[d],userAction:s,wasCorrectPairing:z[`${d}-${x[d].id}`]}]})),r>=x.length?w("finished"):h(r)},[d,x]),D=i.useCallback(()=>m.slice(d,d+4),[m,d]);return{gameState:j,currentCard:m[d],realCard:x[d],cardStack:D(),currentIndex:d,totalCards:x.length,stats:S,handleSwipe:n,correctAnswer:x[d]?z[`${d}-${x[d].id}`]:null}}function P({card:a,index:y,isActive:j,onSwipe:w,correctAnswer:d}){const[h,x]=i.useState(null),[k,z]=i.useState(0),[l,m]=i.useState(!1),[u,S]=i.useState({x:0,rotation:0}),[f,n]=i.useState(null);if(!a)return null;const D=a.character||a.word||"",v=e=>{if(!j||h)return;e.preventDefault(),m(!0),x("swiping");const M=e.touches?e.touches[0].clientX:e.clientX;z(M)},s=e=>{if(!j||!l)return;e.preventDefault();const R=(e.touches?e.touches[0].clientX:e.clientX)-k,A=R/300*6;S({x:R,rotation:Math.max(-8,Math.min(8,A))})},r=()=>{if(!j||!l)return;m(!1);const e=80;u.x<-e?b(!1):u.x>e?b(!0):(x(null),S({x:0,rotation:0}))},o=e=>{!j||h==="exit"||b(e)},b=e=>{const M=e===d,R=e?"right":"left";n(R),x("exit"),S({x:R==="right"?300:-300,rotation:R==="right"?10:-10}),setTimeout(()=>{w(M,R,a.correctRomaji,D)},220)},c=()=>l?"none":h==="exit"?"all 0.22s ease-out":"all 0.28s cubic-bezier(0.34, 1.2, 0.64, 1)",p=Math.min(1,Math.abs(u.x)/50),C=u.x>0,g=u.x<0;return t.jsxs("div",{onTouchStart:v,onTouchMove:s,onTouchEnd:r,onMouseDown:v,onMouseMove:l?s:void 0,onMouseUp:r,onMouseLeave:l?r:void 0,style:{position:"absolute",left:"50%",top:"50%",transform:`
          translateX(calc(-50% + ${u.x}px))
          translateY(-50%)
          rotate(${u.rotation}deg)
        `,width:"calc(100% - 64px)",maxWidth:"340px",height:"calc(100% - 48px)",maxHeight:"500px",background:"var(--color-surface)",borderRadius:"16px",border:"1px solid var(--color-surface-light)",zIndex:100-y,cursor:j&&!l?"grab":l?"grabbing":"default",transition:c(),willChange:"transform, opacity",display:"flex",flexDirection:"column",opacity:h==="exit"?0:1,userSelect:"none",overflow:"hidden",touchAction:"none"},children:[t.jsx("div",{style:{position:"absolute",left:0,top:0,bottom:0,width:"50%",background:`linear-gradient(90deg, rgba(239, 68, 68, ${g?p*.5:0}) 0%, transparent 100%)`,pointerEvents:"none",transition:l?"none":"background 0.2s",display:"flex",alignItems:"center",justifyContent:"flex-start",paddingLeft:"20px"},children:t.jsx("span",{style:{fontSize:"36px",opacity:g?p:0,transform:`scale(${.6+p*.4})`,transition:l?"none":"all 0.2s"},children:"âœ—"})}),t.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:"50%",background:`linear-gradient(-90deg, rgba(16, 185, 129, ${C?p*.5:0}) 0%, transparent 100%)`,pointerEvents:"none",transition:l?"none":"background 0.2s",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"20px"},children:t.jsx("span",{style:{fontSize:"36px",opacity:C?p:0,transform:`scale(${.5+p*.5})`,transition:l?"none":"all 0.2s"},children:"âœ“"})}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,padding:"40px 24px",gap:"20px"},children:[t.jsx("div",{style:{fontSize:"clamp(100px, 28vw, 180px)",fontWeight:"200",lineHeight:1,color:"var(--color-text-primary)",textAlign:"center"},children:D}),(a.shownRomaji||a.romaji)&&t.jsx("div",{style:{fontSize:"28px",color:"var(--color-primary)",fontWeight:"500",letterSpacing:"3px",textTransform:"lowercase"},children:a.shownRomaji||a.romaji})]}),t.jsxs("div",{style:{display:"flex",padding:"20px 24px",paddingBottom:"28px",gap:"16px",opacity:h==="exit"?0:1},children:[t.jsx("button",{onClick:()=>o(!1),disabled:h==="exit",style:{flex:1,padding:"16px 20px",borderRadius:"100px",backgroundColor:"rgba(239, 68, 68, 0.08)",border:"none",color:"#f87171",fontSize:"15px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.15)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.08)"},children:"Falsch"}),t.jsx("button",{onClick:()=>o(!0),disabled:h==="exit",style:{flex:1,padding:"16px 20px",borderRadius:"100px",backgroundColor:"rgba(16, 185, 129, 0.08)",border:"none",color:"#34d399",fontSize:"15px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="rgba(16, 185, 129, 0.15)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="rgba(16, 185, 129, 0.08)"},children:"Richtig"})]})]})}function B({contentType:a,groupId:y,cardCount:j}){T();const[w,d]=i.useState([]),[h,x]=i.useState(!0),[k,z]=i.useState(null),[l,m]=i.useState(null),[u,S]=i.useState(!1),f=i.useRef(null),n=N(w,j),D=(s,r,o,b)=>{f.current&&(clearTimeout(f.current),f.current=null);const c={isCorrect:s,correctRomaji:o,character:b,id:Date.now()};m(c),S(!0),f.current=setTimeout(()=>{S(!1),f.current=setTimeout(()=>m(null),300)},2500),n.handleSwipe(s,r)};if(i.useEffect(()=>()=>{f.current&&clearTimeout(f.current)},[]),i.useEffect(()=>{(async()=>{try{let r;y==="all"?r=await E(a):r=await $(a,y),d(r.items||[])}catch(r){z(r.message),console.error("Failed to load game data:",r)}finally{x(!1)}})()},[a,y]),h)return t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--color-text-tertiary)"},children:"Spiel wird vorbereitet..."});if(k)return t.jsx(W,{children:t.jsxs("div",{style:{padding:"var(--spacing-4)",backgroundColor:"rgba(239, 68, 68, 0.1)",borderRadius:"var(--radius-md)",color:"#ef4444",border:"1px solid rgba(239, 68, 68, 0.3)"},children:["Fehler: ",k]})});if(n.gameState==="finished"){const s=n.stats.correct+n.stats.incorrect,r=s>0?Math.round(n.stats.correct/s*100):0;return t.jsx(W,{children:t.jsxs("div",{className:"space-y-6",children:[t.jsx(I,{children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:"0 0 var(--spacing-4) 0"},children:"Spiel beendet! ðŸŽ‰"}),t.jsxs("div",{className:"grid-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),t.jsxs("p",{className:"text-3xl font-bold",style:{color:"#10b981",margin:"0"},children:[n.stats.correct,"/",s]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Prozentsatz"}),t.jsxs("p",{className:"text-3xl font-bold",style:{color:"var(--color-primary)",margin:"0"},children:[r,"%"]})]})]})]})}),n.stats.mistakes.length>0&&t.jsxs("div",{children:[t.jsxs("h3",{className:"text-base font-medium",style:{color:"var(--color-text-secondary)",marginBottom:"var(--spacing-3)"},children:["Fehler (",n.stats.mistakes.length,")"]}),t.jsx("div",{className:"space-y-3",children:n.stats.mistakes.map((o,b)=>{const c=o.realCard?.character||o.realCard?.word||"?",p=o.displayedCard?.shownRomaji||o.displayedCard?.romaji,C=o.realCard?.romaji,g=o.wasCorrectPairing,e=o.userAction==="right";return t.jsx(I,{children:t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",paddingBottom:"12px",borderBottom:"1px solid var(--color-surface-light)"},children:[t.jsx("div",{style:{fontSize:"40px",fontWeight:"300",color:"var(--color-text-primary)"},children:c}),t.jsx("div",{style:{fontSize:"20px",color:"var(--color-primary)",fontWeight:"500",fontStyle:"italic"},children:p}),t.jsx("div",{style:{marginLeft:"auto",padding:"4px 10px",borderRadius:"100px",fontSize:"12px",fontWeight:"600",backgroundColor:g?"rgba(16, 185, 129, 0.15)":"rgba(239, 68, 68, 0.15)",color:g?"#10b981":"#ef4444"},children:g?"War richtig":"War falsch"})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px",fontSize:"14px"},children:[t.jsxs("div",{style:{color:"var(--color-text-tertiary)"},children:[t.jsx("span",{children:"Deine Antwort: "}),t.jsxs("span",{style:{color:"#ef4444",fontWeight:"600"},children:["â€ž",e?"Richtig":"Falsch",'"']})]}),t.jsxs("div",{style:{color:"var(--color-text-tertiary)"},children:[t.jsx("span",{children:"Korrekte Antwort: "}),t.jsxs("span",{style:{color:"#10b981",fontWeight:"600"},children:["â€ž",g?"Richtig":"Falsch",'"']})]}),!g&&t.jsxs("div",{style:{marginTop:"4px",color:"var(--color-text-secondary)",fontStyle:"italic"},children:[c," = ",C]})]})]})},b)})})]})]})})}const v=n.currentIndex/n.totalCards*100;return t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden",position:"relative"},children:[t.jsx("div",{style:{padding:"12px 16px",textAlign:"center",borderBottom:"1px solid var(--color-surface-light)",backgroundColor:"var(--color-bg-secondary)"},children:t.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:"var(--color-text-secondary)",letterSpacing:"0.3px"},children:"Ist die Kombination richtig?"})}),l&&t.jsx("div",{style:{position:"absolute",top:"60px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,opacity:u?1:0,transition:"opacity 0.3s ease-out",pointerEvents:"none"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 20px",backgroundColor:l.isCorrect?"#10b981":"#ef4444",borderRadius:"12px",boxShadow:"0 4px 20px rgba(0,0,0,0.25)"},children:[t.jsx("span",{style:{fontSize:"20px",fontWeight:"bold",color:"white"},children:l.isCorrect?"âœ“":"âœ—"}),t.jsxs("span",{style:{fontSize:"17px",fontWeight:"600",color:"white",letterSpacing:"0.5px"},children:[l.character," = ",l.correctRomaji]})]})},l.id),t.jsx("div",{style:{flex:1,position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"16px",minHeight:0},children:n.cardStack.map((s,r)=>t.jsx(P,{card:s,index:r,isActive:r===0,onSwipe:D,correctAnswer:r===0?n.correctAnswer:void 0},`${n.currentIndex+r}`))}),t.jsxs("div",{style:{padding:"12px 16px",paddingBottom:"max(12px, env(safe-area-inset-bottom))",backgroundColor:"var(--color-surface)",borderTop:"1px solid var(--color-surface-light)"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px"},children:[t.jsx("div",{style:{flex:1,height:"6px",backgroundColor:"var(--color-surface-light)",borderRadius:"3px",overflow:"hidden"},children:t.jsx("div",{style:{height:"100%",width:`${v}%`,background:"linear-gradient(90deg, var(--color-primary), var(--color-secondary))",borderRadius:"3px",transition:"width 0.3s ease"}})}),t.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:"var(--color-text-secondary)",minWidth:"60px",textAlign:"right"},children:[n.currentIndex+1," / ",n.totalCards]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"24px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{style:{fontSize:"13px",color:"var(--color-text-tertiary)"},children:"Richtig:"}),t.jsx("span",{style:{fontSize:"15px",fontWeight:"700",color:"#10b981"},children:n.stats.correct})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{style:{fontSize:"13px",color:"var(--color-text-tertiary)"},children:"Falsch:"}),t.jsx("span",{style:{fontSize:"15px",fontWeight:"700",color:"#ef4444"},children:n.stats.incorrect})]})]})]})]})}export{B as default};
