import{r as o,j as t,u as $,A as I,C as T,f as A,a as E}from"./index-CEjmFOOZ.js";function N(l,m){const[y,S]=o.useState("loading"),[c,p]=o.useState(0),[x,k]=o.useState([]),[R,i]=o.useState({}),[f,g]=o.useState([]),[v,h]=o.useState({correct:0,incorrect:0,mistakes:[]});o.useEffect(()=>{if(!l||l.length===0){S("error");return}const j=m==="all"?l.length:parseInt(m);let s=[];for(;s.length<j;){const d=j-s.length,u=[...l].sort(()=>Math.random()-.5).slice(0,d);s=[...s,...u]}const r={},a=[],b=[...Array(Math.ceil(s.length/2)).fill(!0),...Array(Math.floor(s.length/2)).fill(!1)].sort(()=>Math.random()-.5);s.forEach((d,u)=>{const D=b[u];if(D)a.push({...d,shownRomaji:d.romaji,correctRomaji:d.romaji,isWrongPairing:!1});else{let w,e=0;const z=20;do w=l[Math.floor(Math.random()*l.length)],e++;while(w.romaji===d.romaji&&e<z);w.romaji===d.romaji?a.push({...d,shownRomaji:d.romaji,correctRomaji:d.romaji,isWrongPairing:!1}):a.push({...d,shownRomaji:w.romaji,correctRomaji:d.romaji,isWrongPairing:!0})}r[`${u}-${d.id}`]=D}),k(s),g(a),i(r),S("playing")},[l,m]);const n=o.useCallback((j,s)=>{const r=c+1;h(j?a=>({...a,correct:a.correct+1}):a=>({...a,incorrect:a.incorrect+1,mistakes:[...a.mistakes,{realCard:x[c],displayedCard:f[c],userAction:s,wasCorrectPairing:R[`${c}-${x[c].id}`]}]})),r>=x.length?S("finished"):p(r)},[c,x]),M=o.useCallback(()=>f.slice(c,c+4),[f,c]);return{gameState:y,currentCard:f[c],realCard:x[c],cardStack:M(),currentIndex:c,totalCards:x.length,stats:v,handleSwipe:n,correctAnswer:x[c]?R[`${c}-${x[c].id}`]:null}}function X({card:l,index:m,isActive:y,onSwipe:S,correctAnswer:c}){const[p,x]=o.useState(null),[k,R]=o.useState(0),[i,f]=o.useState(!1),[g,v]=o.useState({x:0,rotation:0}),[h,n]=o.useState(null);if(!l)return null;const M=l.character||l.word||"",j=e=>{if(!y||p)return;e.preventDefault(),f(!0),x("swiping");const z=e.touches?e.touches[0].clientX:e.clientX;R(z)},s=e=>{if(!y||!i)return;e.preventDefault();const C=(e.touches?e.touches[0].clientX:e.clientX)-k,W=C/300*6;v({x:C,rotation:Math.max(-8,Math.min(8,W))})},r=()=>{if(!y||!i)return;f(!1);const e=80;g.x<-e?b(!1):g.x>e?b(!0):(x(null),v({x:0,rotation:0}))},a=e=>{!y||p==="exit"||b(e)},b=e=>{const z=e===c,C=e?"right":"left";n(C),x("exit"),v({x:C==="right"?300:-300,rotation:C==="right"?10:-10}),setTimeout(()=>{S(z,C,l.correctRomaji,M)},220)},d=()=>i?"none":p==="exit"?"all 0.22s ease-out":"all 0.28s cubic-bezier(0.34, 1.2, 0.64, 1)",u=Math.min(1,Math.abs(g.x)/100),D=g.x>0,w=g.x<0;return t.jsxs("div",{onTouchStart:j,onTouchMove:s,onTouchEnd:r,onMouseDown:j,onMouseMove:i?s:void 0,onMouseUp:r,onMouseLeave:i?r:void 0,style:{position:"absolute",left:"50%",top:"50%",transform:`
          translateX(calc(-50% + ${g.x}px))
          translateY(-50%)
          rotate(${g.rotation}deg)
        `,width:"calc(100% - 40px)",maxWidth:"360px",height:"calc(100% - 32px)",maxHeight:"560px",background:"var(--color-surface)",borderRadius:"16px",border:"1px solid var(--color-surface-light)",zIndex:100-m,cursor:y&&!i?"grab":i?"grabbing":"default",transition:d(),willChange:"transform, opacity",display:"flex",flexDirection:"column",opacity:p==="exit"?0:1,userSelect:"none",overflow:"hidden",touchAction:"none"},children:[t.jsx("div",{style:{position:"absolute",left:0,top:0,bottom:0,width:"80px",background:`linear-gradient(90deg, rgba(239, 68, 68, ${w?u*.3:0}) 0%, transparent 100%)`,pointerEvents:"none",transition:i?"none":"background 0.2s",display:"flex",alignItems:"center",justifyContent:"center",paddingLeft:"16px"},children:t.jsx("span",{style:{fontSize:"32px",opacity:w?u:0,transform:`scale(${.5+u*.5})`,transition:i?"none":"all 0.2s"},children:"âœ—"})}),t.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:"80px",background:`linear-gradient(-90deg, rgba(16, 185, 129, ${D?u*.3:0}) 0%, transparent 100%)`,pointerEvents:"none",transition:i?"none":"background 0.2s",display:"flex",alignItems:"center",justifyContent:"center",paddingRight:"16px"},children:t.jsx("span",{style:{fontSize:"32px",opacity:D?u:0,transform:`scale(${.5+u*.5})`,transition:i?"none":"all 0.2s"},children:"âœ“"})}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,padding:"40px 24px",gap:"20px"},children:[t.jsx("div",{style:{fontSize:"clamp(100px, 28vw, 180px)",fontWeight:"200",lineHeight:1,color:"var(--color-text-primary)",textAlign:"center"},children:M}),(l.shownRomaji||l.romaji)&&t.jsx("div",{style:{fontSize:"28px",color:"var(--color-primary)",fontWeight:"500",letterSpacing:"3px",textTransform:"lowercase"},children:l.shownRomaji||l.romaji})]}),t.jsxs("div",{style:{display:"flex",padding:"20px 24px",paddingBottom:"28px",gap:"16px",opacity:p==="exit"?0:1},children:[t.jsx("button",{onClick:()=>a(!1),disabled:p==="exit",style:{flex:1,padding:"16px 20px",borderRadius:"100px",backgroundColor:"rgba(239, 68, 68, 0.08)",border:"none",color:"#f87171",fontSize:"15px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.15)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.08)"},children:"Falsch"}),t.jsx("button",{onClick:()=>a(!0),disabled:p==="exit",style:{flex:1,padding:"16px 20px",borderRadius:"100px",backgroundColor:"rgba(16, 185, 129, 0.08)",border:"none",color:"#34d399",fontSize:"15px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="rgba(16, 185, 129, 0.15)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="rgba(16, 185, 129, 0.08)"},children:"Richtig"})]})]})}function B({contentType:l,groupId:m,cardCount:y}){$();const[S,c]=o.useState([]),[p,x]=o.useState(!0),[k,R]=o.useState(null),[i,f]=o.useState(null),[g,v]=o.useState(!1),h=o.useRef(null),n=N(S,y),M=(s,r,a,b)=>{h.current&&(clearTimeout(h.current),h.current=null);const d={isCorrect:s,correctRomaji:a,character:b,id:Date.now()};f(d),v(!0),h.current=setTimeout(()=>{v(!1),h.current=setTimeout(()=>f(null),300)},1500),n.handleSwipe(s,r)};if(o.useEffect(()=>()=>{h.current&&clearTimeout(h.current)},[]),o.useEffect(()=>{(async()=>{try{let r;m==="all"?r=await A(l):r=await E(l,m),c(r.items||[])}catch(r){R(r.message),console.error("Failed to load game data:",r)}finally{x(!1)}})()},[l,m]),p)return t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--color-text-tertiary)"},children:"Spiel wird vorbereitet..."});if(k)return t.jsx(I,{children:t.jsxs("div",{style:{padding:"var(--spacing-4)",backgroundColor:"rgba(239, 68, 68, 0.1)",borderRadius:"var(--radius-md)",color:"#ef4444",border:"1px solid rgba(239, 68, 68, 0.3)"},children:["Fehler: ",k]})});if(n.gameState==="finished"){const s=n.stats.correct+n.stats.incorrect,r=s>0?Math.round(n.stats.correct/s*100):0;return t.jsx(I,{children:t.jsxs("div",{className:"space-y-6",children:[t.jsx(T,{children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:"0 0 var(--spacing-4) 0"},children:"Spiel beendet! ðŸŽ‰"}),t.jsxs("div",{className:"grid-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),t.jsxs("p",{className:"text-3xl font-bold",style:{color:"#10b981",margin:"0"},children:[n.stats.correct,"/",s]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Prozentsatz"}),t.jsxs("p",{className:"text-3xl font-bold",style:{color:"var(--color-primary)",margin:"0"},children:[r,"%"]})]})]})]})}),n.stats.mistakes.length>0&&t.jsxs("div",{children:[t.jsxs("h3",{className:"text-base font-medium",style:{color:"var(--color-text-secondary)",marginBottom:"var(--spacing-3)"},children:["Fehler (",n.stats.mistakes.length,")"]}),t.jsx("div",{className:"space-y-3",children:n.stats.mistakes.map((a,b)=>t.jsx(T,{children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-4)"},children:[t.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"var(--color-text-primary)",minWidth:"50px"},children:a.realCard?.character||a.realCard?.word||"?"}),t.jsxs("div",{style:{flex:1},children:[t.jsxs("div",{style:{fontSize:"14px",color:"#ef4444",marginBottom:"2px"},children:["âœ— ",a.displayedCard?.romaji]}),t.jsxs("div",{style:{fontSize:"14px",color:"#10b981"},children:["âœ“ ",a.realCard?.romaji]})]})]})},b))})]})]})})}const j=n.currentIndex/n.totalCards*100;return t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden",position:"relative"},children:[i&&t.jsx("div",{style:{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,opacity:g?1:0,transition:"opacity 0.25s ease-out",pointerEvents:"none"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",padding:"10px 16px",backgroundColor:i.isCorrect?"#10b981":"#ef4444",borderRadius:"var(--radius-lg)",boxShadow:"0 8px 24px rgba(0,0,0,0.3)"},children:[t.jsx("span",{style:{fontSize:"18px",fontWeight:"bold",color:"white"},children:i.isCorrect?"âœ“":"âœ—"}),t.jsx("span",{style:{fontSize:"16px",fontWeight:"600",color:"white"},children:i.isCorrect?"Richtig!":`${i.character} = ${i.correctRomaji}`})]})},i.id),t.jsx("div",{style:{flex:1,position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"16px",minHeight:0},children:n.cardStack.map((s,r)=>t.jsx(X,{card:s,index:r,isActive:r===0,onSwipe:M,correctAnswer:r===0?n.correctAnswer:void 0},`${n.currentIndex+r}`))}),t.jsxs("div",{style:{padding:"12px 16px",paddingBottom:"max(12px, env(safe-area-inset-bottom))",backgroundColor:"var(--color-surface)",borderTop:"1px solid var(--color-surface-light)"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px"},children:[t.jsx("div",{style:{flex:1,height:"6px",backgroundColor:"var(--color-surface-light)",borderRadius:"3px",overflow:"hidden"},children:t.jsx("div",{style:{height:"100%",width:`${j}%`,background:"linear-gradient(90deg, var(--color-primary), var(--color-secondary))",borderRadius:"3px",transition:"width 0.3s ease"}})}),t.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:"var(--color-text-secondary)",minWidth:"60px",textAlign:"right"},children:[n.currentIndex+1," / ",n.totalCards]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"24px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{style:{fontSize:"13px",color:"var(--color-text-tertiary)"},children:"Richtig:"}),t.jsx("span",{style:{fontSize:"15px",fontWeight:"700",color:"#10b981"},children:n.stats.correct})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{style:{fontSize:"13px",color:"var(--color-text-tertiary)"},children:"Falsch:"}),t.jsx("span",{style:{fontSize:"15px",fontWeight:"700",color:"#ef4444"},children:n.stats.incorrect})]})]})]})]})}export{B as default};
