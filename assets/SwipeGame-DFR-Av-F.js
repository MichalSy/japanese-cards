import{r as a,j as e,u as M,A as I,C as T,a as E,f as F}from"./index-D3VmfTFu.js";function W(r,d){const[g,u]=a.useState("loading"),[s,h]=a.useState(0),[c,v]=a.useState([]),[S,t]=a.useState({}),[i,n]=a.useState([]),[o,C]=a.useState({correct:0,incorrect:0,mistakes:[]});a.useEffect(()=>{if(!r||r.length===0){u("error");return}const f=d==="all"?r.length:parseInt(d);let x=[];for(;x.length<f;){const p=f-x.length,w=[...r].sort(()=>Math.random()-.5).slice(0,p);x=[...x,...w]}const y={},l=[];x.forEach((p,w)=>{const N=Math.random()>.5;if(N)l.push(p);else{let m;do m=r[Math.floor(Math.random()*r.length)];while(m.meaning===p.meaning||m.romaji===p.romaji);l.push({...p,meaning:m.meaning,romaji:m.romaji})}y[`${w}-${p.id}`]=N}),v(x),n(l),t(y),u("playing")},[r,d]);const z=a.useCallback((f,x)=>{const y=s+1;C(f?l=>({...l,correct:l.correct+1}):l=>({...l,incorrect:l.incorrect+1,mistakes:[...l.mistakes,{realCard:c[s],displayedCard:i[s],userAction:x,wasCorrectPairing:S[`${s}-${c[s].id}`]}]})),y>=c.length?u("finished"):h(y)},[s,c]),A=a.useCallback(()=>i.slice(s,s+4),[i,s]);return{gameState:g,currentCard:i[s],realCard:c[s],cardStack:A(),currentIndex:s,totalCards:c.length,stats:o,handleSwipe:z,correctAnswer:c[s]?S[`${s}-${c[s].id}`]:null}}function X({card:r,index:d,isActive:g,onSwipe:u,correctAnswer:s}){const[h,c]=a.useState(null),[v,S]=a.useState(0),[t,i]=a.useState(0),[n,o]=a.useState(0),[C,z]=a.useState(1),[A,f]=a.useState(0);if(!r)return null;const x=b=>{g&&S(b.touches[0].clientX)},y=b=>{if(!g||h)return;const j=b.touches[0].clientX-v;Math.abs(j)>20&&(i(j/150*15),o(j))},l=async()=>{if(!g)return;const b=80,k=n<-b,j=n>b;if(k||j){const $=j===s;c($?"correct":"incorrect"),f(1),await new Promise(R=>{setTimeout(()=>{f(0)},200),setTimeout(R,300)}),o(k?-500:500),i(k?-45:45),z(0),await new Promise(R=>setTimeout(R,300)),u($,j?"right":"left")}else i(0),o(0)},p=()=>"var(--color-surface)",w=()=>h==="correct"?"rgba(16, 185, 129, 0.8)":h==="incorrect"?"rgba(239, 68, 68, 0.8)":"transparent",N=()=>100-d,m=()=>d*8;return e.jsxs("div",{onTouchStart:x,onTouchMove:y,onTouchEnd:l,style:{position:"absolute",left:"50%",top:"50%",transform:`
          translateX(calc(-50% + ${n}px + ${m()}px))
          translateY(calc(-50% + ${m()}px))
          rotateZ(${t}deg)
          scale(${1-d*.02})
        `,width:"90%",maxWidth:"400px",height:"500px",backgroundColor:p(),borderRadius:"var(--radius-lg)",border:"2px solid var(--color-surface-light)",zIndex:N(),cursor:g?"grab":"default",transition:"transform 0.05s ease-out",padding:"var(--spacing-6)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"var(--color-text-primary)",opacity:C,userSelect:"none",overflow:"hidden"},children:[h&&e.jsx("div",{style:{position:"absolute",inset:0,backgroundColor:w(),opacity:A,transition:"opacity 0.3s ease",pointerEvents:"none",zIndex:10}}),r.character&&e.jsx("div",{style:{fontSize:"120px",marginBottom:"var(--spacing-4)",fontWeight:"700"},children:r.character}),r.word&&e.jsx("div",{style:{fontSize:"32px",marginBottom:"var(--spacing-4)",fontWeight:"700",textAlign:"center"},children:r.word}),r.meaning&&e.jsx("div",{style:{fontSize:"24px",color:"var(--color-text-secondary)",textAlign:"center"},children:r.meaning}),r.romaji&&e.jsx("div",{style:{fontSize:"16px",color:"var(--color-text-tertiary)",marginTop:"var(--spacing-4)",fontStyle:"italic"},children:r.romaji}),!h&&e.jsxs("div",{style:{position:"absolute",bottom:"var(--spacing-4)",left:0,right:0,display:"flex",justifyContent:"space-around",padding:"0 var(--spacing-4)",fontSize:"12px",color:"var(--color-text-tertiary)"},children:[e.jsx("span",{children:"‚ùå Falsch"}),e.jsx("span",{children:"‚úÖ Richtig"})]})]})}function G({contentType:r,groupId:d,cardCount:g}){M();const[u,s]=a.useState([]),[h,c]=a.useState(!0),[v,S]=a.useState(null),t=W(u,g);if(a.useEffect(()=>{(async()=>{try{const n=await F(r,d);s(n.items||[])}catch(n){S(n.message),console.error("Failed to load game data:",n)}finally{c(!1)}})()},[r,d]),h)return e.jsx(I,{children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx("p",{style:{color:"var(--color-text-tertiary)"},children:"Spiel wird vorbereitet..."})})});if(v)return e.jsx(I,{children:e.jsxs("div",{style:{padding:"var(--spacing-4)",backgroundColor:"#fee2e2",borderRadius:"var(--radius-md)",color:"#991b1b"},children:["Fehler: ",v]})});if(t.gameState==="finished"){const i=t.stats.correct+t.stats.incorrect,n=i>0?Math.round(t.stats.correct/i*100):0;return e.jsx(I,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(T,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:"0 0 var(--spacing-4) 0"},children:"Spiel beendet! üéâ"}),e.jsxs("div",{className:"grid-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"#10b981",margin:"0"},children:[t.stats.correct,"/",i]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Prozentsatz"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"var(--color-primary)",margin:"0"},children:[n,"%"]})]})]})]})}),t.stats.mistakes.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-medium text-primary",style:{marginBottom:"var(--spacing-3)"},children:["Fehler (",t.stats.mistakes.length,")"]}),e.jsx("div",{className:"space-y-3",children:t.stats.mistakes.map((o,C)=>e.jsx(T,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-3)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("p",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:0},children:o.realCard?.character||o.realCard?.word||"?"}),e.jsx("span",{style:{fontSize:"24px"},children:"‚ùå"})]}),e.jsxs("div",{style:{padding:"var(--spacing-2) var(--spacing-3)",backgroundColor:"var(--color-surface-light)",borderRadius:"var(--radius-md)"},children:[e.jsx("p",{className:"text-xs text-tertiary",style:{margin:"0 0 var(--spacing-1) 0"},children:"Gezeigt:"}),e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)",margin:0},children:o.displayedCard?.meaning||o.displayedCard?.romaji||"?"})]}),e.jsxs("div",{style:{padding:"var(--spacing-2) var(--spacing-3)",backgroundColor:"rgba(16, 185, 129, 0.1)",borderRadius:"var(--radius-md)",border:"1px solid #10b981"},children:[e.jsx("p",{className:"text-xs text-tertiary",style:{margin:"0 0 var(--spacing-1) 0"},children:"Korrekt:"}),e.jsx("p",{className:"text-sm font-medium",style:{color:"#10b981",margin:0},children:o.realCard?.meaning||o.realCard?.romaji||"?"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-2)",fontSize:"12px",color:"var(--color-text-tertiary)"},children:[e.jsxs("span",{children:["Du: ",o.userAction==="right"?"‚û°Ô∏è Richtig":"‚¨ÖÔ∏è Falsch"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{children:o.wasCorrectPairing?"War korrekt":"War falsch"})]})]})},C))})]})]})})}return e.jsxs(I,{children:[e.jsx("div",{style:{position:"relative",height:"600px",marginBottom:"var(--spacing-6)"},children:t.cardStack.map((i,n)=>e.jsx(X,{card:i,index:n,isActive:n===0,onSwipe:t.handleSwipe,correctAnswer:n===0?t.correctAnswer:void 0},`${t.currentIndex+n}`))}),e.jsx(T,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-3)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{className:"text-sm font-medium text-primary",children:["Karte ",t.currentIndex+1," / ",t.totalCards]}),e.jsxs("span",{style:{fontSize:"14px",fontWeight:"600",color:"var(--color-primary)"},children:[Math.round((t.currentIndex+1)/t.totalCards*100),"%"]})]}),e.jsx("div",{style:{width:"100%",backgroundColor:"var(--color-surface-light)",borderRadius:"9999px",height:"8px"},children:e.jsx("div",{style:{background:"linear-gradient(to right, var(--color-primary), var(--color-secondary))",height:"8px",borderRadius:"9999px",transition:"width 0.3s ease",width:`${(t.currentIndex+1)/t.totalCards*100}%`}})})]})}),e.jsx(T,{children:e.jsxs("div",{className:"grid-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"#10b981",margin:0},children:t.stats.correct})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Falsch"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"#ef4444",margin:0},children:t.stats.incorrect})]})]})}),e.jsx(E,{children:e.jsx("p",{className:"text-sm text-tertiary",style:{width:"100%",textAlign:"center",margin:0},children:"Wische ‚û°Ô∏è richtig | Wische ‚¨ÖÔ∏è falsch"})})]})}export{G as default};
