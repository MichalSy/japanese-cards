import{r,j as t,u as D,A as I,C as T,a as E,f as F}from"./index-ClfYCGUz.js";function X(s,l){const[p,u]=r.useState("loading"),[n,h]=r.useState(0),[c,j]=r.useState([]),[b,e]=r.useState({}),[i,a]=r.useState([]),[d,v]=r.useState({correct:0,incorrect:0,mistakes:[]});r.useEffect(()=>{if(!s||s.length===0){u("error");return}const m=l==="all"?s.length:parseInt(l);let x=[];for(;x.length<m;){const f=m-x.length,w=[...s].sort(()=>Math.random()-.5).slice(0,f);x=[...x,...w]}const g={},o=[];x.forEach((f,w)=>{const k=Math.random()>.5;if(k)o.push(f);else{const C=s[Math.floor(Math.random()*s.length)];o.push({...f,meaning:C.meaning,romaji:C.romaji})}g[`${w}-${f.id}`]=k}),j(x),a(o),e(g),u("playing")},[s,l]);const z=r.useCallback((m,x)=>{const g=n+1;v(m?o=>({...o,correct:o.correct+1}):o=>({...o,incorrect:o.incorrect+1,mistakes:[...o.mistakes,c[n]]})),g>=c.length?u("finished"):h(g)},[n,c]),A=r.useCallback(()=>i.slice(n,n+4),[i,n]);return{gameState:p,currentCard:i[n],realCard:c[n],cardStack:A(),currentIndex:n,totalCards:c.length,stats:d,handleSwipe:z,correctAnswer:c[n]?b[`${n}-${c[n].id}`]:null}}function W({card:s,index:l,isActive:p,onSwipe:u,correctAnswer:n}){const[h,c]=r.useState(null),[j,b]=r.useState(0),[e,i]=r.useState(0),[a,d]=r.useState(0),[v,z]=r.useState(1),[A,m]=r.useState(0);if(!s)return null;const x=S=>{p&&b(S.touches[0].clientX)},g=S=>{if(!p||h)return;const y=S.touches[0].clientX-j;Math.abs(y)>20&&(i(y/150*15),d(y))},o=async()=>{if(!p)return;const S=80,N=a<-S,y=a>S;if(N||y){const M=y===n;c(M?"correct":"incorrect"),m(1),await new Promise($=>{setTimeout(()=>{m(0)},200),setTimeout($,300)}),d(N?-500:500),i(N?-45:45),z(0),await new Promise($=>setTimeout($,300)),u(M,y?"right":"left")}else i(0),d(0)},f=()=>"var(--color-surface)",w=()=>h==="correct"?"rgba(16, 185, 129, 0.8)":h==="incorrect"?"rgba(239, 68, 68, 0.8)":"transparent",k=()=>100-l,C=()=>l*8;return t.jsxs("div",{onTouchStart:x,onTouchMove:g,onTouchEnd:o,style:{position:"absolute",left:"50%",top:"50%",transform:`
          translateX(calc(-50% + ${a}px + ${C()}px))
          translateY(calc(-50% + ${C()}px))
          rotateZ(${e}deg)
          scale(${1-l*.02})
        `,width:"90%",maxWidth:"400px",height:"500px",backgroundColor:f(),borderRadius:"var(--radius-lg)",border:"2px solid var(--color-surface-light)",zIndex:k(),cursor:p?"grab":"default",transition:"transform 0.05s ease-out",padding:"var(--spacing-6)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"var(--color-text-primary)",opacity:v,userSelect:"none",overflow:"hidden"},children:[h&&t.jsx("div",{style:{position:"absolute",inset:0,backgroundColor:w(),opacity:A,transition:"opacity 0.3s ease",pointerEvents:"none",zIndex:10}}),s.character&&t.jsx("div",{style:{fontSize:"120px",marginBottom:"var(--spacing-4)",fontWeight:"700"},children:s.character}),s.word&&t.jsx("div",{style:{fontSize:"32px",marginBottom:"var(--spacing-4)",fontWeight:"700",textAlign:"center"},children:s.word}),s.meaning&&t.jsx("div",{style:{fontSize:"24px",color:"var(--color-text-secondary)",textAlign:"center"},children:s.meaning}),s.romaji&&t.jsx("div",{style:{fontSize:"16px",color:"var(--color-text-tertiary)",marginTop:"var(--spacing-4)",fontStyle:"italic"},children:s.romaji}),!h&&t.jsxs("div",{style:{position:"absolute",bottom:"var(--spacing-4)",left:0,right:0,display:"flex",justifyContent:"space-around",padding:"0 var(--spacing-4)",fontSize:"12px",color:"var(--color-text-tertiary)"},children:[t.jsx("span",{children:"‚ùå Falsch"}),t.jsx("span",{children:"‚úÖ Richtig"})]})]})}function G({contentType:s,groupId:l,cardCount:p}){D();const[u,n]=r.useState([]),[h,c]=r.useState(!0),[j,b]=r.useState(null),e=X(u,p);if(r.useEffect(()=>{(async()=>{try{const a=await F(s,l);n(a.items||[])}catch(a){b(a.message),console.error("Failed to load game data:",a)}finally{c(!1)}})()},[s,l]),h)return t.jsx(I,{children:t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:t.jsx("p",{style:{color:"var(--color-text-tertiary)"},children:"Spiel wird vorbereitet..."})})});if(j)return t.jsx(I,{children:t.jsxs("div",{style:{padding:"var(--spacing-4)",backgroundColor:"#fee2e2",borderRadius:"var(--radius-md)",color:"#991b1b"},children:["Fehler: ",j]})});if(e.gameState==="finished"){const i=e.stats.correct+e.stats.incorrect,a=i>0?Math.round(e.stats.correct/i*100):0;return t.jsx(I,{children:t.jsxs("div",{className:"space-y-6",children:[t.jsx(T,{children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:"0 0 var(--spacing-4) 0"},children:"Spiel beendet! üéâ"}),t.jsxs("div",{className:"grid-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),t.jsxs("p",{className:"text-3xl font-bold",style:{color:"#10b981",margin:"0"},children:[e.stats.correct,"/",i]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Prozentsatz"}),t.jsxs("p",{className:"text-3xl font-bold",style:{color:"var(--color-primary)",margin:"0"},children:[a,"%"]})]})]})]})}),e.stats.mistakes.length>0&&t.jsxs("div",{children:[t.jsxs("h3",{className:"text-base font-medium text-primary",style:{marginBottom:"var(--spacing-3)"},children:["Fehler (",e.stats.mistakes.length,")"]}),t.jsx("div",{className:"space-y-2",children:e.stats.mistakes.map((d,v)=>t.jsx(T,{children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-base font-medium",style:{color:"var(--color-text-primary)",margin:0},children:d.character||d.word||"Unbekannt"}),t.jsx("p",{className:"text-sm text-tertiary",style:{margin:"var(--spacing-1) 0 0 0"},children:d.meaning||d.romaji})]}),t.jsx("span",{style:{fontSize:"20px"},children:"‚ùå"})]})},v))})]})]})})}return t.jsxs(I,{children:[t.jsx("div",{style:{position:"relative",height:"600px",marginBottom:"var(--spacing-6)"},children:e.cardStack.map((i,a)=>t.jsx(W,{card:i,index:a,isActive:a===0,onSwipe:e.handleSwipe,correctAnswer:a===0?e.correctAnswer:void 0},`${e.currentIndex+a}`))}),t.jsx(T,{children:t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-3)"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("span",{className:"text-sm font-medium text-primary",children:["Karte ",e.currentIndex+1," / ",e.totalCards]}),t.jsxs("span",{style:{fontSize:"14px",fontWeight:"600",color:"var(--color-primary)"},children:[Math.round((e.currentIndex+1)/e.totalCards*100),"%"]})]}),t.jsx("div",{style:{width:"100%",backgroundColor:"var(--color-surface-light)",borderRadius:"9999px",height:"8px"},children:t.jsx("div",{style:{background:"linear-gradient(to right, var(--color-primary), var(--color-secondary))",height:"8px",borderRadius:"9999px",transition:"width 0.3s ease",width:`${(e.currentIndex+1)/e.totalCards*100}%`}})})]})}),t.jsx(T,{children:t.jsxs("div",{className:"grid-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),t.jsx("p",{className:"text-2xl font-bold",style:{color:"#10b981",margin:0},children:e.stats.correct})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Falsch"}),t.jsx("p",{className:"text-2xl font-bold",style:{color:"#ef4444",margin:0},children:e.stats.incorrect})]})]})}),t.jsx(E,{children:t.jsx("p",{className:"text-sm text-tertiary",style:{width:"100%",textAlign:"center",margin:0},children:"Wische ‚û°Ô∏è richtig | Wische ‚¨ÖÔ∏è falsch"})})]})}export{G as default};
