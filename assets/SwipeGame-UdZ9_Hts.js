import{r as n,j as e,u as N,A as I,C as M,a as T,f as W,b as A}from"./index-De8Lljwv.js";function E(s,f){const[y,S]=n.useState("loading"),[i,l]=n.useState(0),[x,w]=n.useState([]),[R,o]=n.useState({}),[m,r]=n.useState([]),[C,g]=n.useState({correct:0,incorrect:0,mistakes:[]});n.useEffect(()=>{if(!s||s.length===0){S("error");return}const j=f==="all"?s.length:parseInt(f);let h=[];for(;h.length<j;){const c=j-h.length,t=[...s].sort(()=>Math.random()-.5).slice(0,c);h=[...h,...t]}const v={},p=[],z=[...Array(Math.ceil(h.length/2)).fill(!0),...Array(Math.floor(h.length/2)).fill(!1)].sort(()=>Math.random()-.5);h.forEach((c,t)=>{const b=z[t];if(b)p.push({...c,shownRomaji:c.romaji,correctRomaji:c.romaji,isWrongPairing:!1});else{let d,k=0;const D=20;do d=s[Math.floor(Math.random()*s.length)],k++;while(d.romaji===c.romaji&&k<D);d.romaji===c.romaji?p.push({...c,shownRomaji:c.romaji,correctRomaji:c.romaji,isWrongPairing:!1}):p.push({...c,shownRomaji:d.romaji,correctRomaji:c.romaji,isWrongPairing:!0})}v[`${t}-${c.id}`]=b}),w(h),r(p),o(v),S("playing")},[s,f]);const a=n.useCallback((j,h)=>{const v=i+1;g(j?p=>({...p,correct:p.correct+1}):p=>({...p,incorrect:p.incorrect+1,mistakes:[...p.mistakes,{realCard:x[i],displayedCard:m[i],userAction:h,wasCorrectPairing:R[`${i}-${x[i].id}`]}]})),v>=x.length?S("finished"):l(v)},[i,x]),u=n.useCallback(()=>m.slice(i,i+4),[m,i]);return{gameState:y,currentCard:m[i],realCard:x[i],cardStack:u(),currentIndex:i,totalCards:x.length,stats:C,handleSwipe:a,correctAnswer:x[i]?R[`${i}-${x[i].id}`]:null}}function F({card:s,index:f,isActive:y,onSwipe:S,correctAnswer:i}){const[l,x]=n.useState(null),[w,R]=n.useState(0),[o,m]=n.useState(!1),[r,C]=n.useState({x:0,rotation:0}),[g,a]=n.useState(null);if(!s)return null;const u=t=>{if(!y||l)return;t.preventDefault(),m(!0),x("swiping");const b=t.touches?t.touches[0].clientX:t.clientX;R(b)},j=t=>{if(!y||!o)return;t.preventDefault();const d=(t.touches?t.touches[0].clientX:t.clientX)-w,k=d/200*12;C({x:d,rotation:Math.max(-15,Math.min(15,k))})},h=()=>{if(!y||!o)return;m(!1);const t=100,b=r.x<-t,d=r.x>t;b||d?p(d):(x(null),C({x:0,rotation:0}))},v=t=>{!y||l==="exit"||p(t)},p=t=>{const b=t===i,d=t?"right":"left";a(d),x("exit"),C({x:d==="right"?400:-400,rotation:d==="right"?20:-20}),setTimeout(()=>{S(b,d,s.correctRomaji)},350)},z=()=>o?"none":l==="exit"?"transform 0.35s cubic-bezier(0.32, 0.72, 0, 1), opacity 0.35s ease-out":"transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)",c=()=>l!=="exit"?"transparent":g==="right"===i?"rgba(16, 185, 129, 0.6)":"rgba(239, 68, 68, 0.6)";return e.jsxs("div",{onTouchStart:u,onTouchMove:j,onTouchEnd:h,onMouseDown:u,onMouseMove:o?j:void 0,onMouseUp:h,onMouseLeave:o?h:void 0,style:{position:"absolute",left:"50%",top:"50%",transform:`
          translateX(calc(-50% + ${r.x}px))
          translateY(-50%)
          rotate(${r.rotation}deg)
        `,transformOrigin:"center center",width:"90%",maxWidth:"420px",height:"580px",backgroundColor:"var(--color-surface)",borderRadius:"32px",border:"1px solid var(--color-surface-light)",zIndex:100-f,cursor:y&&!o?"grab":o?"grabbing":"default",transition:z(),willChange:"transform, opacity",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"var(--color-text-primary)",opacity:l==="exit"?0:1,userSelect:"none",overflow:"hidden",boxShadow:o?"0 32px 64px rgba(0,0,0,0.35)":"0 24px 48px rgba(0,0,0,0.2)",touchAction:"none"},children:[e.jsx("div",{style:{position:"absolute",inset:0,backgroundColor:c(),opacity:l==="exit"?1:0,transition:"opacity 0.15s ease",pointerEvents:"none",zIndex:10,borderRadius:"32px"}}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",left:"20px",top:"50%",transform:"translateY(-50%)",fontSize:"48px",opacity:Math.min(1,Math.max(0,-r.x/100)),transition:"opacity 0.1s",pointerEvents:"none"},children:"‚úó"}),e.jsx("div",{style:{position:"absolute",right:"20px",top:"50%",transform:"translateY(-50%)",fontSize:"48px",opacity:Math.min(1,Math.max(0,r.x/100)),transition:"opacity 0.1s",pointerEvents:"none"},children:"‚úì"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",padding:"var(--spacing-8)",height:"100%",width:"100%"},children:[e.jsx("div",{style:{fontSize:"16px",color:"var(--color-text-secondary)",textAlign:"center",fontWeight:"600",letterSpacing:"0.5px",lineHeight:1.4},children:"Ist das Zeichen richtig zugeordnet?"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"var(--spacing-6)",flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[s.character&&e.jsx("div",{style:{fontSize:"140px",fontWeight:"700",lineHeight:.95,color:"var(--color-text-primary)"},children:s.character}),s.word&&e.jsx("div",{style:{fontSize:"48px",fontWeight:"700",textAlign:"center",lineHeight:1.1,color:"var(--color-text-primary)"},children:s.word})]}),(s.shownRomaji||s.romaji)&&e.jsx("div",{style:{fontSize:"28px",color:"#ec4899",fontWeight:"700",letterSpacing:"0.5px",fontStyle:"italic",padding:"0 var(--spacing-4)",textAlign:"center"},children:s.shownRomaji||s.romaji})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",gap:"var(--spacing-4)",minHeight:"90px",opacity:l==="exit"?0:1,transition:"opacity 0.15s"},children:[e.jsxs("button",{onClick:()=>v(!1),disabled:l==="exit",style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"var(--spacing-4) var(--spacing-3)",borderRadius:"20px",backgroundColor:"rgba(239, 68, 68, 0.15)",border:"2px solid rgba(239, 68, 68, 0.3)",color:"#ef4444",fontSize:"28px",fontWeight:"bold",cursor:l==="exit"?"default":"pointer",transition:"all 0.2s ease",lineHeight:1},onMouseEnter:t=>{l!=="exit"&&(t.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.25)",t.currentTarget.style.borderColor="rgba(239, 68, 68, 0.5)",t.currentTarget.style.transform="scale(1.05)")},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.15)",t.currentTarget.style.borderColor="rgba(239, 68, 68, 0.3)",t.currentTarget.style.transform="scale(1)"},children:["‚Üê",e.jsx("span",{style:{fontSize:"12px",fontWeight:"700",letterSpacing:"0.5px",marginTop:"2px"},children:"Falsch"})]}),e.jsxs("button",{onClick:()=>v(!0),disabled:l==="exit",style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"var(--spacing-4) var(--spacing-3)",borderRadius:"20px",backgroundColor:"rgba(236, 72, 153, 0.2)",border:"2px solid rgba(236, 72, 153, 0.4)",color:"#ec4899",fontSize:"28px",fontWeight:"bold",cursor:l==="exit"?"default":"pointer",transition:"all 0.2s ease",lineHeight:1},onMouseEnter:t=>{l!=="exit"&&(t.currentTarget.style.backgroundColor="rgba(236, 72, 153, 0.3)",t.currentTarget.style.borderColor="rgba(236, 72, 153, 0.6)",t.currentTarget.style.transform="scale(1.05)")},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="rgba(236, 72, 153, 0.2)",t.currentTarget.style.borderColor="rgba(236, 72, 153, 0.4)",t.currentTarget.style.transform="scale(1)"},children:["‚Üí",e.jsx("span",{style:{fontSize:"12px",fontWeight:"700",letterSpacing:"0.5px",marginTop:"2px"},children:"Richtig"})]})]})]})]})}function X({contentType:s,groupId:f,cardCount:y}){N();const[S,i]=n.useState([]),[l,x]=n.useState(!0),[w,R]=n.useState(null),[o,m]=n.useState(null),r=E(S,y),C=(g,a,u)=>{m({isCorrect:g,correctRomaji:u}),setTimeout(()=>m(null),2e3),r.handleSwipe(g,a)};if(n.useEffect(()=>{(async()=>{try{let a;f==="all"?a=await W(s):a=await A(s,f),i(a.items||[])}catch(a){R(a.message),console.error("Failed to load game data:",a)}finally{x(!1)}})()},[s,f]),l)return e.jsx(I,{children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx("p",{style:{color:"var(--color-text-tertiary)"},children:"Spiel wird vorbereitet..."})})});if(w)return e.jsx(I,{children:e.jsxs("div",{style:{padding:"var(--spacing-4)",backgroundColor:"#fee2e2",borderRadius:"var(--radius-md)",color:"#991b1b"},children:["Fehler: ",w]})});if(r.gameState==="finished"){const g=r.stats.correct+r.stats.incorrect,a=g>0?Math.round(r.stats.correct/g*100):0;return e.jsx(I,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(M,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:"0 0 var(--spacing-4) 0"},children:"Spiel beendet! üéâ"}),e.jsxs("div",{className:"grid-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"#10b981",margin:"0"},children:[r.stats.correct,"/",g]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Prozentsatz"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"var(--color-primary)",margin:"0"},children:[a,"%"]})]})]})]})}),r.stats.mistakes.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-medium text-primary",style:{marginBottom:"var(--spacing-3)"},children:["Fehler (",r.stats.mistakes.length,")"]}),e.jsx("div",{className:"space-y-3",children:r.stats.mistakes.map((u,j)=>e.jsx(M,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-3)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("p",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:0},children:u.realCard?.character||u.realCard?.word||"?"}),e.jsx("span",{style:{fontSize:"24px"},children:"‚ùå"})]}),e.jsxs("div",{style:{padding:"var(--spacing-2) var(--spacing-3)",backgroundColor:"var(--color-surface-light)",borderRadius:"var(--radius-md)"},children:[e.jsx("p",{className:"text-xs text-tertiary",style:{margin:"0 0 var(--spacing-1) 0"},children:"Gezeigt:"}),e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)",margin:0},children:u.displayedCard?.romaji||"?"})]}),e.jsxs("div",{style:{padding:"var(--spacing-2) var(--spacing-3)",backgroundColor:"rgba(16, 185, 129, 0.1)",borderRadius:"var(--radius-md)",border:"1px solid #10b981"},children:[e.jsx("p",{className:"text-xs text-tertiary",style:{margin:"0 0 var(--spacing-1) 0"},children:"Korrekt:"}),e.jsx("p",{className:"text-sm font-medium",style:{color:"#10b981",margin:0},children:u.realCard?.romaji||"?"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-2)",fontSize:"12px",color:"var(--color-text-tertiary)"},children:[e.jsxs("span",{children:["Du: ",u.userAction==="right"?"‚û°Ô∏è Richtig":"‚¨ÖÔ∏è Falsch"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{children:u.wasCorrectPairing?"War korrekt":"War falsch"})]})]})},j))})]})]})})}return e.jsxs(I,{children:[o&&e.jsx("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1e3,animation:"toastFadeIn 0.3s ease-in"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px"},children:[e.jsx("div",{style:{width:"100px",height:"100px",borderRadius:"50%",backgroundColor:o.isCorrect?"#10b981":"#ef4444",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"50px",color:"white",fontWeight:"bold",boxShadow:"0 10px 40px rgba(0,0,0,0.3)"},children:o.isCorrect?"‚úì":"‚úó"}),!o.isCorrect&&o.correctRomaji&&e.jsxs("div",{style:{fontSize:"24px",fontWeight:"700",color:"#10b981",fontStyle:"italic"},children:["Richtig: ",o.correctRomaji]})]})}),e.jsx("div",{style:{position:"relative",height:"600px",marginBottom:"var(--spacing-6)",overflow:"hidden"},children:r.cardStack.map((g,a)=>e.jsx(F,{card:g,index:a,isActive:a===0,onSwipe:C,correctAnswer:a===0?r.correctAnswer:void 0},`${r.currentIndex+a}`))}),e.jsx(M,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-3)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{className:"text-sm font-medium text-primary",children:["Karte ",r.currentIndex+1," / ",r.totalCards]}),e.jsxs("span",{style:{fontSize:"14px",fontWeight:"600",color:"var(--color-primary)"},children:[Math.round((r.currentIndex+1)/r.totalCards*100),"%"]})]}),e.jsx("div",{style:{width:"100%",backgroundColor:"var(--color-surface-light)",borderRadius:"9999px",height:"8px"},children:e.jsx("div",{style:{background:"linear-gradient(to right, var(--color-primary), var(--color-secondary))",height:"8px",borderRadius:"9999px",transition:"width 0.3s ease",width:`${(r.currentIndex+1)/r.totalCards*100}%`}})})]})}),e.jsx(M,{children:e.jsxs("div",{className:"grid-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"#10b981",margin:0},children:r.stats.correct})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Falsch"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"#ef4444",margin:0},children:r.stats.incorrect})]})]})}),e.jsx(T,{children:e.jsx("p",{className:"text-sm text-tertiary",style:{width:"100%",textAlign:"center",margin:0},children:"Wische ‚û°Ô∏è richtig | Wische ‚¨ÖÔ∏è falsch"})})]})}export{X as default};
