import{r as n,j as e,u as T,A as I,C as W,f as A,a as E}from"./index-CBSiq57o.js";function N(i,m){const[y,S]=n.useState("loading"),[c,g]=n.useState(0),[x,C]=n.useState([]),[R,l]=n.useState({}),[f,h]=n.useState([]),[v,u]=n.useState({correct:0,incorrect:0,mistakes:[]});n.useEffect(()=>{if(!i||i.length===0){S("error");return}const j=m==="all"?i.length:parseInt(m);let s=[];for(;s.length<j;){const d=j-s.length,p=[...i].sort(()=>Math.random()-.5).slice(0,d);s=[...s,...p]}const r={},a=[],b=[...Array(Math.ceil(s.length/2)).fill(!0),...Array(Math.floor(s.length/2)).fill(!1)].sort(()=>Math.random()-.5);s.forEach((d,p)=>{const M=b[p];if(M)a.push({...d,shownRomaji:d.romaji,correctRomaji:d.romaji,isWrongPairing:!1});else{let z,t=0;const D=20;do z=i[Math.floor(Math.random()*i.length)],t++;while(z.romaji===d.romaji&&t<D);z.romaji===d.romaji?a.push({...d,shownRomaji:d.romaji,correctRomaji:d.romaji,isWrongPairing:!1}):a.push({...d,shownRomaji:z.romaji,correctRomaji:d.romaji,isWrongPairing:!0})}r[`${p}-${d.id}`]=M}),C(s),h(a),l(r),S("playing")},[i,m]);const o=n.useCallback((j,s)=>{const r=c+1;u(j?a=>({...a,correct:a.correct+1}):a=>({...a,incorrect:a.incorrect+1,mistakes:[...a.mistakes,{realCard:x[c],displayedCard:f[c],userAction:s,wasCorrectPairing:R[`${c}-${x[c].id}`]}]})),r>=x.length?S("finished"):g(r)},[c,x]),k=n.useCallback(()=>f.slice(c,c+4),[f,c]);return{gameState:y,currentCard:f[c],realCard:x[c],cardStack:k(),currentIndex:c,totalCards:x.length,stats:v,handleSwipe:o,correctAnswer:x[c]?R[`${c}-${x[c].id}`]:null}}function X({card:i,index:m,isActive:y,onSwipe:S,correctAnswer:c}){const[g,x]=n.useState(null),[C,R]=n.useState(0),[l,f]=n.useState(!1),[h,v]=n.useState({x:0,rotation:0}),[u,o]=n.useState(null);if(!i)return null;const k=i.character||i.word||"",j=t=>{if(!y||g)return;t.preventDefault(),f(!0),x("swiping");const D=t.touches?t.touches[0].clientX:t.clientX;R(D)},s=t=>{if(!y||!l)return;t.preventDefault();const w=(t.touches?t.touches[0].clientX:t.clientX)-C,$=w/250*8;v({x:w,rotation:Math.max(-10,Math.min(10,$))})},r=()=>{if(!y||!l)return;f(!1);const t=80;h.x<-t?b(!1):h.x>t?b(!0):(x(null),v({x:0,rotation:0}))},a=t=>{!y||g==="exit"||b(t)},b=t=>{const D=t===c,w=t?"right":"left";o(w),x("exit"),v({x:w==="right"?320:-320,rotation:w==="right"?12:-12}),setTimeout(()=>{S(D,w,i.correctRomaji,k)},250)},d=()=>l?"none":g==="exit"?"all 0.25s cubic-bezier(0.4, 0, 0.2, 1)":"all 0.3s cubic-bezier(0.34, 1.3, 0.64, 1)",p=Math.min(1,Math.abs(h.x)/100),M=h.x>0,z=h.x<0;return e.jsxs("div",{onTouchStart:j,onTouchMove:s,onTouchEnd:r,onMouseDown:j,onMouseMove:l?s:void 0,onMouseUp:r,onMouseLeave:l?r:void 0,style:{position:"absolute",left:"50%",top:"50%",transform:`
          translateX(calc(-50% + ${h.x}px))
          translateY(-50%)
          rotate(${h.rotation}deg)
        `,width:"calc(100% - 40px)",maxWidth:"360px",height:"calc(100% - 32px)",maxHeight:"560px",background:`linear-gradient(
          180deg,
          var(--color-surface) 0%,
          rgba(30, 41, 59, 0.95) 100%
        )`,borderRadius:"12px",border:`1px solid ${l?M?`rgba(16, 185, 129, ${.3+p*.4})`:z?`rgba(239, 68, 68, ${.3+p*.4})`:"var(--color-surface-light)":"var(--color-surface-light)"}`,zIndex:100-m,cursor:y&&!l?"grab":l?"grabbing":"default",transition:d(),willChange:"transform, opacity",display:"flex",flexDirection:"column",opacity:g==="exit"?0:1,userSelect:"none",overflow:"hidden",boxShadow:"0 4px 20px rgba(0,0,0,0.15)",touchAction:"none"},children:[l&&p>.1&&e.jsx("div",{style:{position:"absolute",inset:0,background:M?`rgba(16, 185, 129, ${p*.15})`:`rgba(239, 68, 68, ${p*.15})`,pointerEvents:"none",borderRadius:"12px"}}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,padding:"32px 24px",gap:"24px"},children:[e.jsx("div",{style:{fontSize:"clamp(100px, 25vw, 160px)",fontWeight:"200",lineHeight:1,color:"var(--color-text-primary)",textAlign:"center"},children:k}),(i.shownRomaji||i.romaji)&&e.jsx("div",{style:{fontSize:"32px",color:"var(--color-primary)",fontWeight:"500",letterSpacing:"2px"},children:i.shownRomaji||i.romaji}),l&&p>.3&&e.jsx("div",{style:{fontSize:"48px",opacity:p,transition:"opacity 0.1s"},children:M?"âœ“":"âœ—"})]}),e.jsxs("div",{style:{display:"flex",padding:"0 20px 24px",gap:"12px",opacity:g==="exit"?0:1},children:[e.jsxs("button",{onClick:()=>a(!1),disabled:g==="exit",style:{flex:1,padding:"14px",borderRadius:"8px",backgroundColor:"transparent",border:"1px solid rgba(239, 68, 68, 0.4)",color:"#ef4444",fontSize:"14px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.1)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="transparent"},children:[e.jsx("span",{children:"â†"})," Falsch"]}),e.jsxs("button",{onClick:()=>a(!0),disabled:g==="exit",style:{flex:1,padding:"14px",borderRadius:"8px",backgroundColor:"transparent",border:"1px solid rgba(16, 185, 129, 0.4)",color:"#10b981",fontSize:"14px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="rgba(16, 185, 129, 0.1)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="transparent"},children:["Richtig ",e.jsx("span",{children:"â†’"})]})]})]})}function F({contentType:i,groupId:m,cardCount:y}){T();const[S,c]=n.useState([]),[g,x]=n.useState(!0),[C,R]=n.useState(null),[l,f]=n.useState(null),[h,v]=n.useState(!1),u=n.useRef(null),o=N(S,y),k=(s,r,a,b)=>{u.current&&(clearTimeout(u.current),u.current=null);const d={isCorrect:s,correctRomaji:a,character:b,id:Date.now()};f(d),v(!0),u.current=setTimeout(()=>{v(!1),u.current=setTimeout(()=>f(null),300)},1500),o.handleSwipe(s,r)};if(n.useEffect(()=>()=>{u.current&&clearTimeout(u.current)},[]),n.useEffect(()=>{(async()=>{try{let r;m==="all"?r=await A(i):r=await E(i,m),c(r.items||[])}catch(r){R(r.message),console.error("Failed to load game data:",r)}finally{x(!1)}})()},[i,m]),g)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--color-text-tertiary)"},children:"Spiel wird vorbereitet..."});if(C)return e.jsx(I,{children:e.jsxs("div",{style:{padding:"var(--spacing-4)",backgroundColor:"rgba(239, 68, 68, 0.1)",borderRadius:"var(--radius-md)",color:"#ef4444",border:"1px solid rgba(239, 68, 68, 0.3)"},children:["Fehler: ",C]})});if(o.gameState==="finished"){const s=o.stats.correct+o.stats.incorrect,r=s>0?Math.round(o.stats.correct/s*100):0;return e.jsx(I,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(W,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:"0 0 var(--spacing-4) 0"},children:"Spiel beendet! ðŸŽ‰"}),e.jsxs("div",{className:"grid-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"#10b981",margin:"0"},children:[o.stats.correct,"/",s]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Prozentsatz"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"var(--color-primary)",margin:"0"},children:[r,"%"]})]})]})]})}),o.stats.mistakes.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-medium",style:{color:"var(--color-text-secondary)",marginBottom:"var(--spacing-3)"},children:["Fehler (",o.stats.mistakes.length,")"]}),e.jsx("div",{className:"space-y-3",children:o.stats.mistakes.map((a,b)=>e.jsx(W,{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-4)"},children:[e.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"var(--color-text-primary)",minWidth:"50px"},children:a.realCard?.character||a.realCard?.word||"?"}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontSize:"14px",color:"#ef4444",marginBottom:"2px"},children:["âœ— ",a.displayedCard?.romaji]}),e.jsxs("div",{style:{fontSize:"14px",color:"#10b981"},children:["âœ“ ",a.realCard?.romaji]})]})]})},b))})]})]})})}const j=o.currentIndex/o.totalCards*100;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden",position:"relative"},children:[l&&e.jsx("div",{style:{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,opacity:h?1:0,transition:"opacity 0.25s ease-out",pointerEvents:"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",padding:"10px 16px",backgroundColor:l.isCorrect?"#10b981":"#ef4444",borderRadius:"var(--radius-lg)",boxShadow:"0 8px 24px rgba(0,0,0,0.3)"},children:[e.jsx("span",{style:{fontSize:"18px",fontWeight:"bold",color:"white"},children:l.isCorrect?"âœ“":"âœ—"}),e.jsx("span",{style:{fontSize:"16px",fontWeight:"600",color:"white"},children:l.isCorrect?"Richtig!":`${l.character} = ${l.correctRomaji}`})]})},l.id),e.jsx("div",{style:{flex:1,position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"16px",minHeight:0},children:o.cardStack.map((s,r)=>e.jsx(X,{card:s,index:r,isActive:r===0,onSwipe:k,correctAnswer:r===0?o.correctAnswer:void 0},`${o.currentIndex+r}`))}),e.jsxs("div",{style:{padding:"12px 16px",paddingBottom:"max(12px, env(safe-area-inset-bottom))",backgroundColor:"var(--color-surface)",borderTop:"1px solid var(--color-surface-light)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px"},children:[e.jsx("div",{style:{flex:1,height:"6px",backgroundColor:"var(--color-surface-light)",borderRadius:"3px",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${j}%`,background:"linear-gradient(90deg, var(--color-primary), var(--color-secondary))",borderRadius:"3px",transition:"width 0.3s ease"}})}),e.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:"var(--color-text-secondary)",minWidth:"60px",textAlign:"right"},children:[o.currentIndex+1," / ",o.totalCards]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"24px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{style:{fontSize:"13px",color:"var(--color-text-tertiary)"},children:"Richtig:"}),e.jsx("span",{style:{fontSize:"15px",fontWeight:"700",color:"#10b981"},children:o.stats.correct})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{style:{fontSize:"13px",color:"var(--color-text-tertiary)"},children:"Falsch:"}),e.jsx("span",{style:{fontSize:"15px",fontWeight:"700",color:"#ef4444"},children:o.stats.incorrect})]})]})]})]})}export{F as default};
