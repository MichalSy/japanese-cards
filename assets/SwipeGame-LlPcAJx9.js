import{r as i,j as e,u as T,A as M,C as I,a as N,f as W,b as A}from"./index-CJIuE9GJ.js";function E(a,f){const[y,S]=i.useState("loading"),[n,l]=i.useState(0),[h,C]=i.useState([]),[w,o]=i.useState({}),[u,m]=i.useState([]),[v,b]=i.useState({correct:0,incorrect:0,mistakes:[]});i.useEffect(()=>{if(!a||a.length===0){S("error");return}const c=f==="all"?a.length:parseInt(f);let r=[];for(;r.length<c;){const g=c-r.length,t=[...a].sort(()=>Math.random()-.5).slice(0,g);r=[...r,...t]}const d={},x=[],z=[...Array(Math.ceil(r.length/2)).fill(!0),...Array(Math.floor(r.length/2)).fill(!1)].sort(()=>Math.random()-.5);r.forEach((g,t)=>{const j=z[t];if(j)x.push({...g,shownRomaji:g.romaji,correctRomaji:g.romaji,isWrongPairing:!1});else{let p,k=0;const D=20;do p=a[Math.floor(Math.random()*a.length)],k++;while(p.romaji===g.romaji&&k<D);p.romaji===g.romaji?x.push({...g,shownRomaji:g.romaji,correctRomaji:g.romaji,isWrongPairing:!1}):x.push({...g,shownRomaji:p.romaji,correctRomaji:g.romaji,isWrongPairing:!0})}d[`${t}-${g.id}`]=j}),C(r),m(x),o(d),S("playing")},[a,f]);const s=i.useCallback((c,r)=>{const d=n+1;b(c?x=>({...x,correct:x.correct+1}):x=>({...x,incorrect:x.incorrect+1,mistakes:[...x.mistakes,{realCard:h[n],displayedCard:u[n],userAction:r,wasCorrectPairing:w[`${n}-${h[n].id}`]}]})),d>=h.length?S("finished"):l(d)},[n,h]),R=i.useCallback(()=>u.slice(n,n+4),[u,n]);return{gameState:y,currentCard:u[n],realCard:h[n],cardStack:R(),currentIndex:n,totalCards:h.length,stats:v,handleSwipe:s,correctAnswer:h[n]?w[`${n}-${h[n].id}`]:null}}function F({card:a,index:f,isActive:y,onSwipe:S,correctAnswer:n}){const[l,h]=i.useState(null),[C,w]=i.useState(0),[o,u]=i.useState(!1),[m,v]=i.useState({x:0,rotation:0}),[b,s]=i.useState(null);if(!a)return null;const R=t=>{if(!y||l)return;t.preventDefault(),u(!0),h("swiping");const j=t.touches?t.touches[0].clientX:t.clientX;w(j)},c=t=>{if(!y||!o)return;t.preventDefault();const p=(t.touches?t.touches[0].clientX:t.clientX)-C,k=p/200*12;v({x:p,rotation:Math.max(-15,Math.min(15,k))})},r=()=>{if(!y||!o)return;u(!1);const t=100,j=m.x<-t,p=m.x>t;j||p?x(p):(h(null),v({x:0,rotation:0}))},d=t=>{!y||l==="exit"||x(t)},x=t=>{const j=t===n,p=t?"right":"left";s(p),h("exit"),v({x:p==="right"?400:-400,rotation:p==="right"?20:-20}),setTimeout(()=>{S(j,p,a.correctRomaji)},350)},z=()=>o?"none":l==="exit"?"transform 0.35s cubic-bezier(0.32, 0.72, 0, 1), opacity 0.35s ease-out":"transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)",g=()=>l!=="exit"?"transparent":b==="right"===n?"rgba(16, 185, 129, 0.6)":"rgba(239, 68, 68, 0.6)";return e.jsxs("div",{onTouchStart:R,onTouchMove:c,onTouchEnd:r,onMouseDown:R,onMouseMove:o?c:void 0,onMouseUp:r,onMouseLeave:o?r:void 0,style:{position:"absolute",left:"50%",top:"50%",transform:`
          translateX(calc(-50% + ${m.x}px))
          translateY(-50%)
          rotate(${m.rotation}deg)
        `,transformOrigin:"center center",width:"90%",maxWidth:"420px",height:"580px",backgroundColor:"var(--color-surface)",borderRadius:"var(--radius-xl)",border:"1px solid var(--color-surface-light)",zIndex:100-f,cursor:y&&!o?"grab":o?"grabbing":"default",transition:z(),willChange:"transform, opacity",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"var(--color-text-primary)",opacity:l==="exit"?0:1,userSelect:"none",overflow:"hidden",boxShadow:o?"0 32px 64px rgba(0,0,0,0.35)":"0 24px 48px rgba(0,0,0,0.2)",touchAction:"none"},children:[e.jsx("div",{style:{position:"absolute",inset:0,backgroundColor:g(),opacity:l==="exit"?1:0,transition:"opacity 0.15s ease",pointerEvents:"none",zIndex:10,borderRadius:"var(--radius-xl)"}}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",left:"20px",top:"50%",transform:"translateY(-50%)",fontSize:"48px",opacity:Math.min(1,Math.max(0,-m.x/100)),transition:"opacity 0.1s",pointerEvents:"none"},children:"‚úó"}),e.jsx("div",{style:{position:"absolute",right:"20px",top:"50%",transform:"translateY(-50%)",fontSize:"48px",opacity:Math.min(1,Math.max(0,m.x/100)),transition:"opacity 0.1s",pointerEvents:"none"},children:"‚úì"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",padding:"var(--spacing-8)",height:"100%",width:"100%"},children:[e.jsx("div",{style:{fontSize:"16px",color:"var(--color-text-secondary)",textAlign:"center",fontWeight:"600",letterSpacing:"0.5px",lineHeight:1.4},children:"Ist das Zeichen richtig zugeordnet?"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"var(--spacing-6)",flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[a.character&&e.jsx("div",{style:{fontSize:"140px",fontWeight:"700",lineHeight:.95,color:"var(--color-text-primary)"},children:a.character}),a.word&&e.jsx("div",{style:{fontSize:"48px",fontWeight:"700",textAlign:"center",lineHeight:1.1,color:"var(--color-text-primary)"},children:a.word})]}),(a.shownRomaji||a.romaji)&&e.jsx("div",{style:{fontSize:"28px",color:"#ec4899",fontWeight:"700",letterSpacing:"0.5px",fontStyle:"italic",padding:"0 var(--spacing-4)",textAlign:"center"},children:a.shownRomaji||a.romaji})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",gap:"var(--spacing-4)",minHeight:"90px",opacity:l==="exit"?0:1,transition:"opacity 0.15s"},children:[e.jsxs("button",{onClick:()=>d(!1),disabled:l==="exit",style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"var(--spacing-4) var(--spacing-3)",borderRadius:"var(--radius-lg)",backgroundColor:"rgba(239, 68, 68, 0.15)",border:"2px solid rgba(239, 68, 68, 0.3)",color:"#ef4444",fontSize:"28px",fontWeight:"bold",cursor:l==="exit"?"default":"pointer",transition:"all 0.2s ease",lineHeight:1},onMouseEnter:t=>{l!=="exit"&&(t.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.25)",t.currentTarget.style.borderColor="rgba(239, 68, 68, 0.5)",t.currentTarget.style.transform="scale(1.05)")},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.15)",t.currentTarget.style.borderColor="rgba(239, 68, 68, 0.3)",t.currentTarget.style.transform="scale(1)"},children:["‚Üê",e.jsx("span",{style:{fontSize:"12px",fontWeight:"700",letterSpacing:"0.5px",marginTop:"2px"},children:"Falsch"})]}),e.jsxs("button",{onClick:()=>d(!0),disabled:l==="exit",style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"var(--spacing-4) var(--spacing-3)",borderRadius:"var(--radius-lg)",backgroundColor:"rgba(236, 72, 153, 0.2)",border:"2px solid rgba(236, 72, 153, 0.4)",color:"#ec4899",fontSize:"28px",fontWeight:"bold",cursor:l==="exit"?"default":"pointer",transition:"all 0.2s ease",lineHeight:1},onMouseEnter:t=>{l!=="exit"&&(t.currentTarget.style.backgroundColor="rgba(236, 72, 153, 0.3)",t.currentTarget.style.borderColor="rgba(236, 72, 153, 0.6)",t.currentTarget.style.transform="scale(1.05)")},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="rgba(236, 72, 153, 0.2)",t.currentTarget.style.borderColor="rgba(236, 72, 153, 0.4)",t.currentTarget.style.transform="scale(1)"},children:["‚Üí",e.jsx("span",{style:{fontSize:"12px",fontWeight:"700",letterSpacing:"0.5px",marginTop:"2px"},children:"Richtig"})]})]})]})]})}function X({contentType:a,groupId:f,cardCount:y}){T();const[S,n]=i.useState([]),[l,h]=i.useState(!0),[C,w]=i.useState(null),[o,u]=i.useState(null),[m,v]=i.useState(!1),b=i.useRef(null),s=E(S,y),R=(c,r,d)=>{b.current&&clearTimeout(b.current),u({isCorrect:c,correctRomaji:d,id:Date.now()}),v(!0),b.current=setTimeout(()=>{v(!1),setTimeout(()=>u(null),300)},1500),s.handleSwipe(c,r)};if(i.useEffect(()=>{(async()=>{try{let r;f==="all"?r=await W(a):r=await A(a,f),n(r.items||[])}catch(r){w(r.message),console.error("Failed to load game data:",r)}finally{h(!1)}})()},[a,f]),l)return e.jsx(M,{children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx("p",{style:{color:"var(--color-text-tertiary)"},children:"Spiel wird vorbereitet..."})})});if(C)return e.jsx(M,{children:e.jsxs("div",{style:{padding:"var(--spacing-4)",backgroundColor:"#fee2e2",borderRadius:"var(--radius-md)",color:"#991b1b"},children:["Fehler: ",C]})});if(s.gameState==="finished"){const c=s.stats.correct+s.stats.incorrect,r=c>0?Math.round(s.stats.correct/c*100):0;return e.jsx(M,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(I,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:"0 0 var(--spacing-4) 0"},children:"Spiel beendet! üéâ"}),e.jsxs("div",{className:"grid-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"#10b981",margin:"0"},children:[s.stats.correct,"/",c]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Prozentsatz"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"var(--color-primary)",margin:"0"},children:[r,"%"]})]})]})]})}),s.stats.mistakes.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-medium text-primary",style:{marginBottom:"var(--spacing-3)"},children:["Fehler (",s.stats.mistakes.length,")"]}),e.jsx("div",{className:"space-y-3",children:s.stats.mistakes.map((d,x)=>e.jsx(I,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-3)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("p",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:0},children:d.realCard?.character||d.realCard?.word||"?"}),e.jsx("span",{style:{fontSize:"24px"},children:"‚ùå"})]}),e.jsxs("div",{style:{padding:"var(--spacing-2) var(--spacing-3)",backgroundColor:"var(--color-surface-light)",borderRadius:"var(--radius-md)"},children:[e.jsx("p",{className:"text-xs text-tertiary",style:{margin:"0 0 var(--spacing-1) 0"},children:"Gezeigt:"}),e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)",margin:0},children:d.displayedCard?.romaji||"?"})]}),e.jsxs("div",{style:{padding:"var(--spacing-2) var(--spacing-3)",backgroundColor:"rgba(16, 185, 129, 0.1)",borderRadius:"var(--radius-md)",border:"1px solid #10b981"},children:[e.jsx("p",{className:"text-xs text-tertiary",style:{margin:"0 0 var(--spacing-1) 0"},children:"Korrekt:"}),e.jsx("p",{className:"text-sm font-medium",style:{color:"#10b981",margin:0},children:d.realCard?.romaji||"?"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-2)",fontSize:"12px",color:"var(--color-text-tertiary)"},children:[e.jsxs("span",{children:["Du: ",d.userAction==="right"?"‚û°Ô∏è Richtig":"‚¨ÖÔ∏è Falsch"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{children:d.wasCorrectPairing?"War korrekt":"War falsch"})]})]})},x))})]})]})})}return e.jsxs(M,{children:[o&&e.jsx("div",{style:{position:"fixed",top:"80px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,opacity:m?1:0,transition:"opacity 0.3s ease-out",pointerEvents:"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-3)",padding:"var(--spacing-3) var(--spacing-4)",backgroundColor:o.isCorrect?"rgba(16, 185, 129, 0.95)":"rgba(239, 68, 68, 0.95)",borderRadius:"var(--radius-lg)",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"var(--radius-md)",backgroundColor:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",color:"white",fontWeight:"bold"},children:o.isCorrect?"‚úì":"‚úó"}),e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:"white"},children:o.isCorrect?"Richtig!":`Falsch ‚Üí ${o.correctRomaji}`})]})},o.id),e.jsx("div",{style:{position:"relative",height:"600px",marginBottom:"var(--spacing-6)",overflow:"hidden"},children:s.cardStack.map((c,r)=>e.jsx(F,{card:c,index:r,isActive:r===0,onSwipe:R,correctAnswer:r===0?s.correctAnswer:void 0},`${s.currentIndex+r}`))}),e.jsx(I,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-3)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{className:"text-sm font-medium text-primary",children:["Karte ",s.currentIndex+1," / ",s.totalCards]}),e.jsxs("span",{style:{fontSize:"14px",fontWeight:"600",color:"var(--color-primary)"},children:[Math.round((s.currentIndex+1)/s.totalCards*100),"%"]})]}),e.jsx("div",{style:{width:"100%",backgroundColor:"var(--color-surface-light)",borderRadius:"9999px",height:"8px"},children:e.jsx("div",{style:{background:"linear-gradient(to right, var(--color-primary), var(--color-secondary))",height:"8px",borderRadius:"9999px",transition:"width 0.3s ease",width:`${(s.currentIndex+1)/s.totalCards*100}%`}})})]})}),e.jsx(I,{children:e.jsxs("div",{className:"grid-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"#10b981",margin:0},children:s.stats.correct})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Falsch"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"#ef4444",margin:0},children:s.stats.incorrect})]})]})}),e.jsx(N,{children:e.jsx("p",{className:"text-sm text-tertiary",style:{width:"100%",textAlign:"center",margin:0},children:"Wische ‚û°Ô∏è richtig | Wische ‚¨ÖÔ∏è falsch"})})]})}export{X as default};
