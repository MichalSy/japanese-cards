import{r as n,j as t,u as T,A as I,C as D,f as W,a as E}from"./index-Dhui0MWw.js";function A(a,y){const[j,C]=n.useState("loading"),[l,p]=n.useState(0),[x,w]=n.useState([]),[z,c]=n.useState({}),[f,m]=n.useState([]),[v,g]=n.useState({correct:0,incorrect:0,mistakes:[]});n.useEffect(()=>{if(!a||a.length===0){C("error");return}const b=y==="all"?a.length:parseInt(y);let s=[];for(;s.length<b;){const d=b-s.length,M=[...a].sort(()=>Math.random()-.5).slice(0,d);s=[...s,...M]}const r={},i=[],S=[...Array(Math.ceil(s.length/2)).fill(!0),...Array(Math.floor(s.length/2)).fill(!1)].sort(()=>Math.random()-.5);s.forEach((d,M)=>{const e=S[M];if(e)i.push({...d,shownRomaji:d.romaji,correctRomaji:d.romaji,isWrongPairing:!1});else{let u,h=0;const k=20;do u=a[Math.floor(Math.random()*a.length)],h++;while(u.romaji===d.romaji&&h<k);u.romaji===d.romaji?i.push({...d,shownRomaji:d.romaji,correctRomaji:d.romaji,isWrongPairing:!1}):i.push({...d,shownRomaji:u.romaji,correctRomaji:d.romaji,isWrongPairing:!0})}r[`${M}-${d.id}`]=e}),w(s),m(i),c(r),C("playing")},[a,y]);const o=n.useCallback((b,s)=>{const r=l+1;g(b?i=>({...i,correct:i.correct+1}):i=>({...i,incorrect:i.incorrect+1,mistakes:[...i.mistakes,{realCard:x[l],displayedCard:f[l],userAction:s,wasCorrectPairing:z[`${l}-${x[l].id}`]}]})),r>=x.length?C("finished"):p(r)},[l,x]),R=n.useCallback(()=>f.slice(l,l+4),[f,l]);return{gameState:j,currentCard:f[l],realCard:x[l],cardStack:R(),currentIndex:l,totalCards:x.length,stats:v,handleSwipe:o,correctAnswer:x[l]?z[`${l}-${x[l].id}`]:null}}function $({card:a,index:y,isActive:j,onSwipe:C,correctAnswer:l}){const[p,x]=n.useState(null),[w,z]=n.useState(0),[c,f]=n.useState(!1),[m,v]=n.useState({x:0,rotation:0}),[g,o]=n.useState(null);if(!a)return null;const R=a.character||a.word||"",b=e=>{if(!j||p)return;e.preventDefault(),f(!0),x("swiping");const u=e.touches?e.touches[0].clientX:e.clientX;z(u)},s=e=>{if(!j||!c)return;e.preventDefault();const h=(e.touches?e.touches[0].clientX:e.clientX)-w,k=h/200*10;v({x:h,rotation:Math.max(-12,Math.min(12,k))})},r=()=>{if(!j||!c)return;f(!1);const e=80,u=m.x<-e,h=m.x>e;u||h?S(h):(x(null),v({x:0,rotation:0}))},i=e=>{!j||p==="exit"||S(e)},S=e=>{const u=e===l,h=e?"right":"left";o(h),x("exit"),v({x:h==="right"?350:-350,rotation:h==="right"?15:-15}),setTimeout(()=>{C(u,h,a.correctRomaji,R)},280)},d=()=>c?"none":p==="exit"?"transform 0.28s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.28s ease-out":"transform 0.35s cubic-bezier(0.34, 1.4, 0.64, 1)",M=()=>p!=="exit"?"transparent":g==="right"===l?"rgba(16, 185, 129, 0.4)":"rgba(239, 68, 68, 0.4)";return t.jsxs("div",{onTouchStart:b,onTouchMove:s,onTouchEnd:r,onMouseDown:b,onMouseMove:c?s:void 0,onMouseUp:r,onMouseLeave:c?r:void 0,style:{position:"absolute",left:"50%",top:"50%",transform:`
          translateX(calc(-50% + ${m.x}px))
          translateY(-50%)
          rotate(${m.rotation}deg)
        `,width:"calc(100% - 32px)",maxWidth:"400px",height:"calc(100% - 24px)",maxHeight:"600px",backgroundColor:"var(--color-surface)",borderRadius:"20px",border:"1px solid var(--color-surface-light)",zIndex:100-y,cursor:j&&!c?"grab":c?"grabbing":"default",transition:d(),willChange:"transform, opacity",display:"flex",flexDirection:"column",opacity:p==="exit"?0:1,userSelect:"none",overflow:"hidden",boxShadow:c?"0 20px 50px rgba(0,0,0,0.4)":"0 12px 40px rgba(0,0,0,0.25)",touchAction:"none"},children:[t.jsx("div",{style:{position:"absolute",inset:0,backgroundColor:M(),opacity:p==="exit"?1:0,transition:"opacity 0.15s ease",pointerEvents:"none",zIndex:10,borderRadius:"20px"}}),c&&t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"absolute",left:"24px",top:"50%",transform:"translateY(-50%)",fontSize:"56px",opacity:Math.min(1,Math.max(0,-m.x/80)),color:"#ef4444",pointerEvents:"none"},children:"âœ—"}),t.jsx("div",{style:{position:"absolute",right:"24px",top:"50%",transform:"translateY(-50%)",fontSize:"56px",opacity:Math.min(1,Math.max(0,m.x/80)),color:"#10b981",pointerEvents:"none"},children:"âœ“"})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",padding:"24px",height:"100%",width:"100%"},children:[t.jsx("div",{style:{fontSize:"15px",color:"var(--color-text-tertiary)",textAlign:"center",fontWeight:"500"},children:"Ist das Zeichen richtig zugeordnet?"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"16px",flex:1},children:[t.jsx("div",{style:{fontSize:"clamp(80px, 20vw, 140px)",fontWeight:"300",lineHeight:1,color:"var(--color-text-primary)"},children:R}),(a.shownRomaji||a.romaji)&&t.jsx("div",{style:{fontSize:"28px",color:"var(--color-primary)",fontWeight:"600",fontStyle:"italic"},children:a.shownRomaji||a.romaji})]}),t.jsxs("div",{style:{display:"flex",width:"100%",gap:"12px",opacity:p==="exit"?0:1},children:[t.jsxs("button",{onClick:()=>i(!1),disabled:p==="exit",style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"16px",borderRadius:"14px",backgroundColor:"rgba(239, 68, 68, 0.12)",border:"1px solid rgba(239, 68, 68, 0.25)",color:"#ef4444",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.15s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.2)",e.currentTarget.style.transform="scale(1.02)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.12)",e.currentTarget.style.transform="scale(1)"},children:[t.jsx("span",{style:{fontSize:"20px"},children:"â†"}),"Falsch"]}),t.jsxs("button",{onClick:()=>i(!0),disabled:p==="exit",style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"16px",borderRadius:"14px",backgroundColor:"rgba(16, 185, 129, 0.12)",border:"1px solid rgba(16, 185, 129, 0.25)",color:"#10b981",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.15s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="rgba(16, 185, 129, 0.2)",e.currentTarget.style.transform="scale(1.02)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="rgba(16, 185, 129, 0.12)",e.currentTarget.style.transform="scale(1)"},children:["Richtig",t.jsx("span",{style:{fontSize:"20px"},children:"â†’"})]})]})]})]})}function X({contentType:a,groupId:y,cardCount:j}){T();const[C,l]=n.useState([]),[p,x]=n.useState(!0),[w,z]=n.useState(null),[c,f]=n.useState(null),[m,v]=n.useState(!1),g=n.useRef(null),o=A(C,j),R=(s,r,i,S)=>{g.current&&(clearTimeout(g.current),g.current=null);const d={isCorrect:s,correctRomaji:i,character:S,id:Date.now()};f(d),v(!0),g.current=setTimeout(()=>{v(!1),g.current=setTimeout(()=>f(null),300)},1500),o.handleSwipe(s,r)};if(n.useEffect(()=>()=>{g.current&&clearTimeout(g.current)},[]),n.useEffect(()=>{(async()=>{try{let r;y==="all"?r=await W(a):r=await E(a,y),l(r.items||[])}catch(r){z(r.message),console.error("Failed to load game data:",r)}finally{x(!1)}})()},[a,y]),p)return t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--color-text-tertiary)"},children:"Spiel wird vorbereitet..."});if(w)return t.jsx(I,{children:t.jsxs("div",{style:{padding:"var(--spacing-4)",backgroundColor:"rgba(239, 68, 68, 0.1)",borderRadius:"var(--radius-md)",color:"#ef4444",border:"1px solid rgba(239, 68, 68, 0.3)"},children:["Fehler: ",w]})});if(o.gameState==="finished"){const s=o.stats.correct+o.stats.incorrect,r=s>0?Math.round(o.stats.correct/s*100):0;return t.jsx(I,{children:t.jsxs("div",{className:"space-y-6",children:[t.jsx(D,{children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:"0 0 var(--spacing-4) 0"},children:"Spiel beendet! ðŸŽ‰"}),t.jsxs("div",{className:"grid-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),t.jsxs("p",{className:"text-3xl font-bold",style:{color:"#10b981",margin:"0"},children:[o.stats.correct,"/",s]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Prozentsatz"}),t.jsxs("p",{className:"text-3xl font-bold",style:{color:"var(--color-primary)",margin:"0"},children:[r,"%"]})]})]})]})}),o.stats.mistakes.length>0&&t.jsxs("div",{children:[t.jsxs("h3",{className:"text-base font-medium",style:{color:"var(--color-text-secondary)",marginBottom:"var(--spacing-3)"},children:["Fehler (",o.stats.mistakes.length,")"]}),t.jsx("div",{className:"space-y-3",children:o.stats.mistakes.map((i,S)=>t.jsx(D,{children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-4)"},children:[t.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"var(--color-text-primary)",minWidth:"50px"},children:i.realCard?.character||i.realCard?.word||"?"}),t.jsxs("div",{style:{flex:1},children:[t.jsxs("div",{style:{fontSize:"14px",color:"#ef4444",marginBottom:"2px"},children:["âœ— ",i.displayedCard?.romaji]}),t.jsxs("div",{style:{fontSize:"14px",color:"#10b981"},children:["âœ“ ",i.realCard?.romaji]})]})]})},S))})]})]})})}const b=o.currentIndex/o.totalCards*100;return t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden",position:"relative"},children:[c&&t.jsx("div",{style:{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,opacity:m?1:0,transition:"opacity 0.25s ease-out",pointerEvents:"none"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",padding:"10px 16px",backgroundColor:c.isCorrect?"#10b981":"#ef4444",borderRadius:"var(--radius-lg)",boxShadow:"0 8px 24px rgba(0,0,0,0.3)"},children:[t.jsx("span",{style:{fontSize:"18px",fontWeight:"bold",color:"white"},children:c.isCorrect?"âœ“":"âœ—"}),t.jsx("span",{style:{fontSize:"16px",fontWeight:"600",color:"white"},children:c.isCorrect?"Richtig!":`${c.character} = ${c.correctRomaji}`})]})},c.id),t.jsx("div",{style:{flex:1,position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"16px",minHeight:0},children:o.cardStack.map((s,r)=>t.jsx($,{card:s,index:r,isActive:r===0,onSwipe:R,correctAnswer:r===0?o.correctAnswer:void 0},`${o.currentIndex+r}`))}),t.jsxs("div",{style:{padding:"12px 16px",paddingBottom:"max(12px, env(safe-area-inset-bottom))",backgroundColor:"var(--color-surface)",borderTop:"1px solid var(--color-surface-light)"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px"},children:[t.jsx("div",{style:{flex:1,height:"6px",backgroundColor:"var(--color-surface-light)",borderRadius:"3px",overflow:"hidden"},children:t.jsx("div",{style:{height:"100%",width:`${b}%`,background:"linear-gradient(90deg, var(--color-primary), var(--color-secondary))",borderRadius:"3px",transition:"width 0.3s ease"}})}),t.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:"var(--color-text-secondary)",minWidth:"60px",textAlign:"right"},children:[o.currentIndex+1," / ",o.totalCards]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"24px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{style:{fontSize:"13px",color:"var(--color-text-tertiary)"},children:"Richtig:"}),t.jsx("span",{style:{fontSize:"15px",fontWeight:"700",color:"#10b981"},children:o.stats.correct})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{style:{fontSize:"13px",color:"var(--color-text-tertiary)"},children:"Falsch:"}),t.jsx("span",{style:{fontSize:"15px",fontWeight:"700",color:"#ef4444"},children:o.stats.incorrect})]})]})]})]})}export{X as default};
