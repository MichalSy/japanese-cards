import{r as a,a as W,b as T,j as e,u as A,A as I,C as $,f as N,c as L}from"./index-7y_dz59_.js";function X(s,j,p){const[M,S]=a.useState("loading"),[r,C]=a.useState(0),[u,z]=a.useState([]),[l,k]=a.useState({}),[g,w]=a.useState([]),[m,i]=a.useState({correct:0,incorrect:0,mistakes:[]});a.useEffect(()=>{if(!s||s.length===0){S("error");return}const d=j==="all"?s.length:parseInt(j);let o=[];for(;o.length<d;){const n=d-o.length,b=[...s].sort(()=>Math.random()-.5).slice(0,n);o=[...o,...b]}const h={},x=[],c=[...Array(Math.ceil(o.length/2)).fill(!0),...Array(Math.floor(o.length/2)).fill(!1)].sort(()=>Math.random()-.5);o.forEach((n,b)=>{const D=c[b];if(D)x.push({...n,shownRomaji:n.romaji,correctRomaji:n.romaji,isWrongPairing:!1});else{let t,f=0;const v=20;do t=s[Math.floor(Math.random()*s.length)],f++;while(t.romaji===n.romaji&&f<v);t.romaji===n.romaji?x.push({...n,shownRomaji:n.romaji,correctRomaji:n.romaji,isWrongPairing:!1}):x.push({...n,shownRomaji:t.romaji,correctRomaji:n.romaji,isWrongPairing:!0})}h[`${b}-${n.id}`]=D}),z(o),w(x),k(h),S("playing")},[s,j]);const R=a.useCallback((d,o)=>{const h=r+1,x=u[r];p&&x&&(d?W(p,x.id):T(p,x.id)),i(d?c=>({...c,correct:c.correct+1}):c=>({...c,incorrect:c.incorrect+1,mistakes:[...c.mistakes,{realCard:u[r],displayedCard:g[r],userAction:o,wasCorrectPairing:l[`${r}-${u[r].id}`]}]})),h>=u.length?S("finished"):C(h)},[r,u,p]),y=a.useCallback(()=>g.slice(r,r+4),[g,r]);return{gameState:M,currentCard:g[r],realCard:u[r],cardStack:y(),currentIndex:r,totalCards:u.length,stats:m,handleSwipe:R,correctAnswer:u[r]?l[`${r}-${u[r].id}`]:null}}function B({card:s,index:j,isActive:p,onSwipe:M,correctAnswer:S}){const[r,C]=a.useState(null),[u,z]=a.useState(0),[l,k]=a.useState(!1),[g,w]=a.useState({x:0,rotation:0}),[m,i]=a.useState(null),R=s?.character||s?.word||"",y=a.useCallback(t=>{if(!s||r==="exit")return;const f=t===S,v=t?"right":"left";i(v),C("exit"),w({x:v==="right"?300:-300,rotation:v==="right"?10:-10}),setTimeout(()=>{M(f,v,s.correctRomaji,R)},220)},[s,S,M,R,r]);if(a.useEffect(()=>{if(!p||r||!s)return;const t=f=>{f.key==="ArrowLeft"?(f.preventDefault(),y(!1)):f.key==="ArrowRight"&&(f.preventDefault(),y(!0))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[p,r,s,y]),!s)return null;const d=t=>{if(!p||r)return;t.preventDefault(),k(!0),C("swiping");const f=t.touches?t.touches[0].clientX:t.clientX;z(f)},o=t=>{if(!p||!l)return;t.preventDefault();const v=(t.touches?t.touches[0].clientX:t.clientX)-u,E=v/300*6;w({x:v,rotation:Math.max(-8,Math.min(8,E))})},h=()=>{if(!p||!l)return;k(!1);const t=80;g.x<-t?y(!1):g.x>t?y(!0):(C(null),w({x:0,rotation:0}))},x=t=>{!p||r==="exit"||y(t)},c=()=>l?"none":r==="exit"?"all 0.22s ease-out":"all 0.28s cubic-bezier(0.34, 1.2, 0.64, 1)",n=Math.min(1,Math.abs(g.x)/50),b=g.x>0,D=g.x<0;return e.jsxs("div",{onTouchStart:d,onTouchMove:o,onTouchEnd:h,onMouseDown:d,onMouseMove:l?o:void 0,onMouseUp:h,onMouseLeave:l?h:void 0,style:{position:"absolute",left:"50%",top:"50%",transform:`
          translateX(calc(-50% + ${g.x}px))
          translateY(-50%)
          rotate(${g.rotation}deg)
        `,width:"calc(100% - 64px)",maxWidth:"340px",height:"calc(100% - 48px)",maxHeight:"500px",background:"var(--color-surface)",borderRadius:"16px",border:"1px solid var(--color-surface-light)",zIndex:100-j,cursor:p&&!l?"grab":l?"grabbing":"default",transition:c(),willChange:"transform, opacity",display:"flex",flexDirection:"column",opacity:r==="exit"?0:1,userSelect:"none",overflow:"hidden",touchAction:"none"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:0,bottom:0,width:"50%",background:`linear-gradient(90deg, rgba(239, 68, 68, ${D?n*.5:0}) 0%, transparent 100%)`,pointerEvents:"none",transition:l?"none":"background 0.2s",display:"flex",alignItems:"center",justifyContent:"flex-start",paddingLeft:"20px"},children:e.jsx("span",{style:{fontSize:"36px",opacity:D?n:0,transform:`scale(${.6+n*.4})`,transition:l?"none":"all 0.2s"},children:"âœ—"})}),e.jsx("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:"50%",background:`linear-gradient(-90deg, rgba(16, 185, 129, ${b?n*.5:0}) 0%, transparent 100%)`,pointerEvents:"none",transition:l?"none":"background 0.2s",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"20px"},children:e.jsx("span",{style:{fontSize:"36px",opacity:b?n:0,transform:`scale(${.5+n*.5})`,transition:l?"none":"all 0.2s"},children:"âœ“"})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,padding:"40px 24px",gap:"20px"},children:[e.jsx("div",{style:{fontSize:"clamp(100px, 28vw, 180px)",fontWeight:"200",lineHeight:1,color:"var(--color-text-primary)",textAlign:"center"},children:R}),(s.shownRomaji||s.romaji)&&e.jsx("div",{style:{fontSize:"28px",color:"var(--color-primary)",fontWeight:"500",letterSpacing:"3px",textTransform:"lowercase"},children:s.shownRomaji||s.romaji})]}),e.jsxs("div",{style:{display:"flex",padding:"20px 24px",paddingBottom:"28px",gap:"16px",opacity:r==="exit"?0:1},children:[e.jsx("button",{onClick:()=>x(!1),disabled:r==="exit",style:{flex:1,padding:"16px 20px",borderRadius:"100px",backgroundColor:"rgba(239, 68, 68, 0.08)",border:"none",color:"#f87171",fontSize:"15px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.15)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.08)"},children:"â† Falsch"}),e.jsx("button",{onClick:()=>x(!0),disabled:r==="exit",style:{flex:1,padding:"16px 20px",borderRadius:"100px",backgroundColor:"rgba(16, 185, 129, 0.08)",border:"none",color:"#34d399",fontSize:"15px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="rgba(16, 185, 129, 0.15)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="rgba(16, 185, 129, 0.08)"},children:"Richtig â†’"})]})]})}function F({contentType:s,groupId:j,cardCount:p}){A();const[M,S]=a.useState([]),[r,C]=a.useState(!0),[u,z]=a.useState(null),[l,k]=a.useState(null),[g,w]=a.useState(!1),m=a.useRef(null),i=X(M,p,s),R=(d,o,h,x)=>{m.current&&(clearTimeout(m.current),m.current=null);const c={isCorrect:d,correctRomaji:h,character:x,id:Date.now()};k(c),w(!0),m.current=setTimeout(()=>{w(!1),m.current=setTimeout(()=>k(null),300)},2500),i.handleSwipe(d,o)};if(a.useEffect(()=>()=>{m.current&&clearTimeout(m.current)},[]),a.useEffect(()=>{(async()=>{try{let o;j==="all"?o=await N(s):o=await L(s,j),S(o.items||[])}catch(o){z(o.message),console.error("Failed to load game data:",o)}finally{C(!1)}})()},[s,j]),r)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--color-text-tertiary)"},children:"Spiel wird vorbereitet..."});if(u)return e.jsx(I,{children:e.jsxs("div",{style:{padding:"var(--spacing-4)",backgroundColor:"rgba(239, 68, 68, 0.1)",borderRadius:"var(--radius-md)",color:"#ef4444",border:"1px solid rgba(239, 68, 68, 0.3)"},children:["Fehler: ",u]})});if(i.gameState==="finished"){const d=i.stats.correct+i.stats.incorrect,o=d>0?Math.round(i.stats.correct/d*100):0;return e.jsx(I,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx($,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:"0 0 var(--spacing-4) 0"},children:"Spiel beendet! ðŸŽ‰"}),e.jsxs("div",{className:"grid-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"#10b981",margin:"0"},children:[i.stats.correct,"/",d]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Prozentsatz"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"var(--color-primary)",margin:"0"},children:[o,"%"]})]})]})]})}),i.stats.mistakes.length>0&&(()=>{const h=[],x=new Set;return i.stats.mistakes.forEach(c=>{const n=c.realCard?.character||c.realCard?.word;n&&!x.has(n)&&(x.add(n),h.push(c))}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium",style:{color:"var(--color-text-secondary)",marginBottom:"var(--spacing-4)"},children:"ðŸ“š Nochmal Ã¼ben"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"12px"},children:h.map((c,n)=>{const b=c.realCard?.character||c.realCard?.word||"?",D=c.realCard?.romaji;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px 16px",backgroundColor:"var(--color-surface)",borderRadius:"16px",border:"1px solid var(--color-surface-light)"},children:[e.jsx("span",{style:{fontSize:"48px",fontWeight:"300",color:"var(--color-text-primary)",lineHeight:1,marginBottom:"8px"},children:b}),e.jsx("span",{style:{fontSize:"16px",color:"var(--color-primary)",fontWeight:"600"},children:D})]},n)})})]})})()]})})}const y=i.currentIndex/i.totalCards*100;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden",position:"relative"},children:[e.jsx("div",{style:{padding:"12px 16px",textAlign:"center",borderBottom:"1px solid var(--color-surface-light)",backgroundColor:"var(--color-bg-secondary)"},children:e.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:"var(--color-text-secondary)",letterSpacing:"0.3px"},children:"Ist die Kombination richtig?"})}),l&&e.jsx("div",{style:{position:"absolute",top:"60px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,opacity:g?1:0,transition:"opacity 0.3s ease-out",pointerEvents:"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 20px",backgroundColor:l.isCorrect?"#10b981":"#ef4444",borderRadius:"12px",boxShadow:"0 4px 20px rgba(0,0,0,0.25)"},children:[e.jsx("span",{style:{fontSize:"20px",fontWeight:"bold",color:"white"},children:l.isCorrect?"âœ“":"âœ—"}),e.jsxs("span",{style:{fontSize:"17px",fontWeight:"600",color:"white",letterSpacing:"0.5px"},children:[l.character," = ",l.correctRomaji]})]})},l.id),e.jsx("div",{style:{flex:1,position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"16px",minHeight:0},children:i.cardStack.map((d,o)=>e.jsx(B,{card:d,index:o,isActive:o===0,onSwipe:R,correctAnswer:o===0?i.correctAnswer:void 0},`${i.currentIndex+o}`))}),e.jsxs("div",{style:{padding:"12px 16px",paddingBottom:"max(12px, env(safe-area-inset-bottom))",backgroundColor:"var(--color-surface)",borderTop:"1px solid var(--color-surface-light)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px"},children:[e.jsx("div",{style:{flex:1,height:"6px",backgroundColor:"var(--color-surface-light)",borderRadius:"3px",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${y}%`,background:"linear-gradient(90deg, var(--color-primary), var(--color-secondary))",borderRadius:"3px",transition:"width 0.3s ease"}})}),e.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:"var(--color-text-secondary)",minWidth:"60px",textAlign:"right"},children:[i.currentIndex+1," / ",i.totalCards]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"24px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{style:{fontSize:"13px",color:"var(--color-text-tertiary)"},children:"Richtig:"}),e.jsx("span",{style:{fontSize:"15px",fontWeight:"700",color:"#10b981"},children:i.stats.correct})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{style:{fontSize:"13px",color:"var(--color-text-tertiary)"},children:"Falsch:"}),e.jsx("span",{style:{fontSize:"15px",fontWeight:"700",color:"#ef4444"},children:i.stats.incorrect})]})]})]})]})}export{F as default};
