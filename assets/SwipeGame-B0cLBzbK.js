import{r as n,j as e,u as T,A as I,C as k,a as F,f as M,b as $}from"./index-Bgp1HNum.js";function E(r,h){const[m,u]=n.useState("loading"),[s,p]=n.useState(0),[l,v]=n.useState([]),[S,t]=n.useState({}),[i,a]=n.useState([]),[o,b]=n.useState({correct:0,incorrect:0,mistakes:[]});n.useEffect(()=>{if(!r||r.length===0){u("error");return}const f=h==="all"?r.length:parseInt(h);let x=[];for(;x.length<f;){const g=f-x.length,C=[...r].sort(()=>Math.random()-.5).slice(0,g);x=[...x,...C]}const y={},c=[];x.forEach((g,C)=>{const w=Math.random()>.5;if(w)c.push(g);else{let d;do d=r[Math.floor(Math.random()*r.length)];while(d.meaning===g.meaning||d.romaji===g.romaji);c.push({...g,meaning:d.meaning,romaji:d.romaji})}y[`${C}-${g.id}`]=w}),v(x),a(c),t(y),u("playing")},[r,h]);const z=n.useCallback((f,x)=>{const y=s+1;b(f?c=>({...c,correct:c.correct+1}):c=>({...c,incorrect:c.incorrect+1,mistakes:[...c.mistakes,{realCard:l[s],displayedCard:i[s],userAction:x,wasCorrectPairing:S[`${s}-${l[s].id}`]}]})),y>=l.length?u("finished"):p(y)},[s,l]),R=n.useCallback(()=>i.slice(s,s+4),[i,s]);return{gameState:m,currentCard:i[s],realCard:l[s],cardStack:R(),currentIndex:s,totalCards:l.length,stats:o,handleSwipe:z,correctAnswer:l[s]?S[`${s}-${l[s].id}`]:null}}function X({card:r,index:h,isActive:m,onSwipe:u,correctAnswer:s}){const[p,l]=n.useState(null),[v,S]=n.useState(0),[t,i]=n.useState(0),[a,o]=n.useState(0),[b,z]=n.useState(1),[R,f]=n.useState(0);if(!r)return null;const x=d=>{m&&S(d.touches[0].clientX)},y=d=>{if(!m||p)return;const j=d.touches[0].clientX-v;Math.abs(j)>20&&(i(j/150*15),o(j))},c=async()=>{if(!m)return;const d=80,N=a<-d,j=a>d;if(N||j){const A=j===s;l(A?"correct":"incorrect"),f(1),await new Promise(W=>{setTimeout(()=>{f(0)},200),setTimeout(W,300)}),o(N?-500:500),i(N?-45:45),z(0),await new Promise(W=>setTimeout(W,300)),u(A,j?"right":"left")}else i(0),o(0)},g=()=>"var(--color-surface)",C=()=>p==="correct"?"rgba(16, 185, 129, 0.8)":p==="incorrect"?"rgba(239, 68, 68, 0.8)":"transparent",w=()=>100-h;return e.jsxs("div",{onTouchStart:x,onTouchMove:y,onTouchEnd:c,style:{position:"absolute",left:"50%",top:"50%",transform:`
          translateX(calc(-50% + ${a}px))
          translateY(-50%)
          rotateZ(${t}deg)
        `,width:"90%",maxWidth:"380px",height:"520px",backgroundColor:g(),borderRadius:"24px",border:"2px solid var(--color-surface-light)",zIndex:w(),cursor:m?"grab":"default",transition:"transform 0.05s ease-out",padding:"var(--spacing-8)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",color:"var(--color-text-primary)",opacity:b,userSelect:"none",overflow:"hidden",boxShadow:"0 20px 40px rgba(0,0,0,0.15)"},children:[p&&e.jsx("div",{style:{position:"absolute",inset:0,backgroundColor:C(),opacity:R,transition:"opacity 0.3s ease",pointerEvents:"none",zIndex:10,borderRadius:"24px"}}),e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:[r.character&&e.jsx("div",{style:{fontSize:"140px",fontWeight:"700",lineHeight:1},children:r.character}),r.word&&e.jsx("div",{style:{fontSize:"48px",fontWeight:"700",textAlign:"center",lineHeight:1},children:r.word})]}),e.jsx("div",{style:{fontSize:"16px",color:"var(--color-text-secondary)",textAlign:"center",marginBottom:"var(--spacing-4)",fontWeight:"500",opacity:.8},children:"Ist das Zeichen richtig zugeordnet?"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"var(--spacing-4)"},children:[r.romaji&&e.jsx("div",{style:{fontSize:"20px",color:"#ec4899",fontWeight:"600",letterSpacing:"1px",fontStyle:"italic"},children:r.romaji}),!p&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",maxWidth:"280px",gap:"var(--spacing-6)",marginTop:"var(--spacing-2)"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"var(--spacing-3)",borderRadius:"16px",backgroundColor:"rgba(239, 68, 68, 0.1)",color:"#ef4444",fontSize:"28px",fontWeight:"bold",opacity:.7},children:["‚Üê",e.jsx("span",{style:{fontSize:"12px",fontWeight:"600",letterSpacing:"0.5px"},children:"Falsch"})]}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"var(--spacing-3)",borderRadius:"16px",backgroundColor:"rgba(236, 72, 153, 0.15)",color:"#ec4899",fontSize:"28px",fontWeight:"bold",opacity:.8},children:["‚Üí",e.jsx("span",{style:{fontSize:"12px",fontWeight:"600",letterSpacing:"0.5px"},children:"Richtig"})]})]})]})]})}function P({contentType:r,groupId:h,cardCount:m}){T();const[u,s]=n.useState([]),[p,l]=n.useState(!0),[v,S]=n.useState(null),t=E(u,m);if(n.useEffect(()=>{(async()=>{try{let a;h==="all"?a=await M(r):a=await $(r,h),s(a.items||[])}catch(a){S(a.message),console.error("Failed to load game data:",a)}finally{l(!1)}})()},[r,h]),p)return e.jsx(I,{children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx("p",{style:{color:"var(--color-text-tertiary)"},children:"Spiel wird vorbereitet..."})})});if(v)return e.jsx(I,{children:e.jsxs("div",{style:{padding:"var(--spacing-4)",backgroundColor:"#fee2e2",borderRadius:"var(--radius-md)",color:"#991b1b"},children:["Fehler: ",v]})});if(t.gameState==="finished"){const i=t.stats.correct+t.stats.incorrect,a=i>0?Math.round(t.stats.correct/i*100):0;return e.jsx(I,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(k,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:"0 0 var(--spacing-4) 0"},children:"Spiel beendet! üéâ"}),e.jsxs("div",{className:"grid-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"#10b981",margin:"0"},children:[t.stats.correct,"/",i]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Prozentsatz"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"var(--color-primary)",margin:"0"},children:[a,"%"]})]})]})]})}),t.stats.mistakes.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-medium text-primary",style:{marginBottom:"var(--spacing-3)"},children:["Fehler (",t.stats.mistakes.length,")"]}),e.jsx("div",{className:"space-y-3",children:t.stats.mistakes.map((o,b)=>e.jsx(k,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-3)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("p",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:0},children:o.realCard?.character||o.realCard?.word||"?"}),e.jsx("span",{style:{fontSize:"24px"},children:"‚ùå"})]}),e.jsxs("div",{style:{padding:"var(--spacing-2) var(--spacing-3)",backgroundColor:"var(--color-surface-light)",borderRadius:"var(--radius-md)"},children:[e.jsx("p",{className:"text-xs text-tertiary",style:{margin:"0 0 var(--spacing-1) 0"},children:"Gezeigt:"}),e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)",margin:0},children:o.displayedCard?.meaning||o.displayedCard?.romaji||"?"})]}),e.jsxs("div",{style:{padding:"var(--spacing-2) var(--spacing-3)",backgroundColor:"rgba(16, 185, 129, 0.1)",borderRadius:"var(--radius-md)",border:"1px solid #10b981"},children:[e.jsx("p",{className:"text-xs text-tertiary",style:{margin:"0 0 var(--spacing-1) 0"},children:"Korrekt:"}),e.jsx("p",{className:"text-sm font-medium",style:{color:"#10b981",margin:0},children:o.realCard?.meaning||o.realCard?.romaji||"?"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-2)",fontSize:"12px",color:"var(--color-text-tertiary)"},children:[e.jsxs("span",{children:["Du: ",o.userAction==="right"?"‚û°Ô∏è Richtig":"‚¨ÖÔ∏è Falsch"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{children:o.wasCorrectPairing?"War korrekt":"War falsch"})]})]})},b))})]})]})})}return e.jsxs(I,{children:[e.jsx("div",{style:{position:"relative",height:"600px",marginBottom:"var(--spacing-6)"},children:t.cardStack.map((i,a)=>e.jsx(X,{card:i,index:a,isActive:a===0,onSwipe:t.handleSwipe,correctAnswer:a===0?t.correctAnswer:void 0},`${t.currentIndex+a}`))}),e.jsx(k,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-3)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{className:"text-sm font-medium text-primary",children:["Karte ",t.currentIndex+1," / ",t.totalCards]}),e.jsxs("span",{style:{fontSize:"14px",fontWeight:"600",color:"var(--color-primary)"},children:[Math.round((t.currentIndex+1)/t.totalCards*100),"%"]})]}),e.jsx("div",{style:{width:"100%",backgroundColor:"var(--color-surface-light)",borderRadius:"9999px",height:"8px"},children:e.jsx("div",{style:{background:"linear-gradient(to right, var(--color-primary), var(--color-secondary))",height:"8px",borderRadius:"9999px",transition:"width 0.3s ease",width:`${(t.currentIndex+1)/t.totalCards*100}%`}})})]})}),e.jsx(k,{children:e.jsxs("div",{className:"grid-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"#10b981",margin:0},children:t.stats.correct})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Falsch"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"#ef4444",margin:0},children:t.stats.incorrect})]})]})}),e.jsx(F,{children:e.jsx("p",{className:"text-sm text-tertiary",style:{width:"100%",textAlign:"center",margin:0},children:"Wische ‚û°Ô∏è richtig | Wische ‚¨ÖÔ∏è falsch"})})]})}export{P as default};
