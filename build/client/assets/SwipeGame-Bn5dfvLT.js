import{r as a,j as e,u as $,A as z,C as W,a as X,f as P,b as T}from"./index-CyDwyhqA.js";function H(s,y){const[p,b]=a.useState("loading"),[i,h]=a.useState(0),[g,w]=a.useState([]),[R,m]=a.useState({}),[j,r]=a.useState([]),[I,l]=a.useState({correct:0,incorrect:0,mistakes:[]});a.useEffect(()=>{if(!s||s.length===0){b("error");return}const u=y==="all"?s.length:parseInt(y);let x=[];for(;x.length<u;){const o=u-x.length,S=[...s].sort(()=>Math.random()-.5).slice(0,o);x=[...x,...S]}const v={},d=[],M=[...Array(Math.ceil(x.length/2)).fill(!0),...Array(Math.floor(x.length/2)).fill(!1)].sort(()=>Math.random()-.5);x.forEach((o,S)=>{const k=M[S];if(k)d.push({...o,shownRomaji:o.romaji,correctRomaji:o.romaji,isWrongPairing:!1});else{let C,D=0;const A=20;do C=s[Math.floor(Math.random()*s.length)],D++;while(C.romaji===o.romaji&&D<A);C.romaji===o.romaji?d.push({...o,shownRomaji:o.romaji,correctRomaji:o.romaji,isWrongPairing:!1}):d.push({...o,shownRomaji:C.romaji,correctRomaji:o.romaji,isWrongPairing:!0})}v[`${S}-${o.id}`]=k}),w(x),r(d),m(v),b("playing")},[s,y]);const n=a.useCallback((u,x)=>{const v=i+1;l(u?d=>({...d,correct:d.correct+1}):d=>({...d,incorrect:d.incorrect+1,mistakes:[...d.mistakes,{realCard:g[i],displayedCard:j[i],userAction:x,wasCorrectPairing:R[`${i}-${g[i].id}`]}]})),v>=g.length?b("finished"):h(v)},[i,g]),c=a.useCallback(()=>j.slice(i,i+4),[j,i]);return{gameState:p,currentCard:j[i],realCard:g[i],cardStack:c(),currentIndex:i,totalCards:g.length,stats:I,handleSwipe:n,correctAnswer:g[i]?R[`${i}-${g[i].id}`]:null}}function G({card:s,index:y,isActive:p,onSwipe:b,correctAnswer:i}){const[h,g]=a.useState(null),[w,R]=a.useState(!1),[m,j]=a.useState(0),[r,I]=a.useState(!1),[l,n]=a.useState(0),[c,u]=a.useState(0),[x,v]=a.useState(1),[d,M]=a.useState(0);if(!s)return null;const o=t=>{!p||h||(I(!0),j(t.touches?t.touches[0].clientX:t.clientX))},S=t=>{if(!p||h||!r)return;const f=(t.touches?t.touches[0].clientX:t.clientX)-m;Math.abs(f)>20&&(n(f/150*15),u(f))},k=async()=>{if(!p)return;I(!1);const t=80,N=c<-t,f=c>t;N||f?await D(f):(n(0),u(0))},C=async t=>{!p||h||await D(t)},D=async t=>{if(!p)return;const N=t===i;g(N?"correct":"incorrect"),M(1),R(!0),await new Promise(f=>setTimeout(f,200)),u(t?500:-500),n(t?45:-45),v(0),M(0),await new Promise(f=>setTimeout(f,600)),b(N,t?"right":"left",s.correctRomaji)},A=()=>"var(--color-surface)",F=()=>h==="correct"?"rgba(16, 185, 129, 0.8)":h==="incorrect"?"rgba(239, 68, 68, 0.8)":"transparent",E=()=>100-y;return e.jsxs("div",{onTouchStart:o,onTouchMove:S,onTouchEnd:k,onMouseDown:o,onMouseMove:r?S:void 0,onMouseUp:k,onMouseLeave:r?k:void 0,style:{position:"absolute",left:"50%",top:"50%",transform:`
          translateX(calc(-50% + ${c}px))
          translateY(-50%)
          rotateZ(${l}deg)
        `,width:"90%",maxWidth:"420px",height:"580px",backgroundColor:A(),borderRadius:"32px",border:"1px solid var(--color-surface-light)",zIndex:E(),cursor:p&&!r?"grab":r?"grabbing":"default",transition:r?"none":"transform 0.05s ease-out, opacity 0.6s ease-out",padding:"0",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"var(--color-text-primary)",opacity:x,userSelect:"none",overflow:"hidden",boxShadow:"0 24px 48px rgba(0,0,0,0.2)",touchAction:"none"},children:[h&&e.jsx("div",{style:{position:"absolute",inset:0,backgroundColor:F(),opacity:d,transition:"opacity 0.3s ease",pointerEvents:"none",zIndex:10,borderRadius:"32px"}}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",padding:"var(--spacing-8)",height:"100%",width:"100%"},children:[e.jsx("div",{style:{fontSize:"16px",color:"var(--color-text-secondary)",textAlign:"center",fontWeight:"600",letterSpacing:"0.5px",lineHeight:1.4},children:"Ist das Zeichen richtig zugeordnet?"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"var(--spacing-6)",flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[s.character&&e.jsx("div",{style:{fontSize:"140px",fontWeight:"700",lineHeight:.95,color:"var(--color-text-primary)"},children:s.character}),s.word&&e.jsx("div",{style:{fontSize:"48px",fontWeight:"700",textAlign:"center",lineHeight:1.1,color:"var(--color-text-primary)"},children:s.word})]}),(s.shownRomaji||s.romaji)&&e.jsx("div",{style:{fontSize:"28px",color:"#ec4899",fontWeight:"700",letterSpacing:"0.5px",fontStyle:"italic",padding:"0 var(--spacing-4)",textAlign:"center"},children:s.shownRomaji||s.romaji})]}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",gap:"var(--spacing-4)",flexDirection:w?"column":"row",alignItems:"center",minHeight:"90px"},children:h===null&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>C(!1),style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"var(--spacing-4) var(--spacing-3)",borderRadius:"20px",backgroundColor:"rgba(239, 68, 68, 0.15)",border:"2px solid rgba(239, 68, 68, 0.3)",color:"#ef4444",fontSize:"28px",fontWeight:"bold",cursor:"pointer",transition:"all 0.2s ease",lineHeight:1},onMouseEnter:t=>{t.target.style.backgroundColor="rgba(239, 68, 68, 0.25)",t.target.style.borderColor="rgba(239, 68, 68, 0.5)",t.target.style.transform="scale(1.05)"},onMouseLeave:t=>{t.target.style.backgroundColor="rgba(239, 68, 68, 0.15)",t.target.style.borderColor="rgba(239, 68, 68, 0.3)",t.target.style.transform="scale(1)"},children:["‚Üê",e.jsx("span",{style:{fontSize:"12px",fontWeight:"700",letterSpacing:"0.5px",marginTop:"2px"},children:"Falsch"})]}),e.jsxs("button",{onClick:()=>C(!0),style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"var(--spacing-4) var(--spacing-3)",borderRadius:"20px",backgroundColor:"rgba(236, 72, 153, 0.2)",border:"2px solid rgba(236, 72, 153, 0.4)",color:"#ec4899",fontSize:"28px",fontWeight:"bold",cursor:"pointer",transition:"all 0.2s ease",lineHeight:1},onMouseEnter:t=>{t.target.style.backgroundColor="rgba(236, 72, 153, 0.3)",t.target.style.borderColor="rgba(236, 72, 153, 0.6)",t.target.style.transform="scale(1.05)"},onMouseLeave:t=>{t.target.style.backgroundColor="rgba(236, 72, 153, 0.2)",t.target.style.borderColor="rgba(236, 72, 153, 0.4)",t.target.style.transform="scale(1)"},children:["‚Üí",e.jsx("span",{style:{fontSize:"12px",fontWeight:"700",letterSpacing:"0.5px",marginTop:"2px"},children:"Richtig"})]})]})})]}),e.jsx("style",{children:`
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateY(-10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
      `})]})}function B({contentType:s,groupId:y,cardCount:p}){$();const[b,i]=a.useState([]),[h,g]=a.useState(!0),[w,R]=a.useState(null),[m,j]=a.useState(null),r=H(b,p),I=(l,n,c)=>{j({isCorrect:l,correctRomaji:c}),setTimeout(()=>j(null),2e3),r.handleSwipe(l,n)};if(a.useEffect(()=>{(async()=>{try{let n;y==="all"?n=await P(s):n=await T(s,y),i(n.items||[])}catch(n){R(n.message),console.error("Failed to load game data:",n)}finally{g(!1)}})()},[s,y]),h)return e.jsx(z,{children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx("p",{style:{color:"var(--color-text-tertiary)"},children:"Spiel wird vorbereitet..."})})});if(w)return e.jsx(z,{children:e.jsxs("div",{style:{padding:"var(--spacing-4)",backgroundColor:"#fee2e2",borderRadius:"var(--radius-md)",color:"#991b1b"},children:["Fehler: ",w]})});if(r.gameState==="finished"){const l=r.stats.correct+r.stats.incorrect,n=l>0?Math.round(r.stats.correct/l*100):0;return e.jsx(z,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(W,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:"0 0 var(--spacing-4) 0"},children:"Spiel beendet! üéâ"}),e.jsxs("div",{className:"grid-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"#10b981",margin:"0"},children:[r.stats.correct,"/",l]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Prozentsatz"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"var(--color-primary)",margin:"0"},children:[n,"%"]})]})]})]})}),r.stats.mistakes.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-medium text-primary",style:{marginBottom:"var(--spacing-3)"},children:["Fehler (",r.stats.mistakes.length,")"]}),e.jsx("div",{className:"space-y-3",children:r.stats.mistakes.map((c,u)=>e.jsx(W,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-3)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("p",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)",margin:0},children:c.realCard?.character||c.realCard?.word||"?"}),e.jsx("span",{style:{fontSize:"24px"},children:"‚ùå"})]}),e.jsxs("div",{style:{padding:"var(--spacing-2) var(--spacing-3)",backgroundColor:"var(--color-surface-light)",borderRadius:"var(--radius-md)"},children:[e.jsx("p",{className:"text-xs text-tertiary",style:{margin:"0 0 var(--spacing-1) 0"},children:"Gezeigt:"}),e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)",margin:0},children:c.displayedCard?.romaji||"?"})]}),e.jsxs("div",{style:{padding:"var(--spacing-2) var(--spacing-3)",backgroundColor:"rgba(16, 185, 129, 0.1)",borderRadius:"var(--radius-md)",border:"1px solid #10b981"},children:[e.jsx("p",{className:"text-xs text-tertiary",style:{margin:"0 0 var(--spacing-1) 0"},children:"Korrekt:"}),e.jsx("p",{className:"text-sm font-medium",style:{color:"#10b981",margin:0},children:c.realCard?.romaji||"?"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-2)",fontSize:"12px",color:"var(--color-text-tertiary)"},children:[e.jsxs("span",{children:["Du: ",c.userAction==="right"?"‚û°Ô∏è Richtig":"‚¨ÖÔ∏è Falsch"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{children:c.wasCorrectPairing?"War korrekt":"War falsch"})]})]})},u))})]})]})})}return e.jsxs(z,{children:[m&&e.jsx("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1e3,animation:"toastFadeIn 0.3s ease-in"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px"},children:[e.jsx("div",{style:{width:"100px",height:"100px",borderRadius:"50%",backgroundColor:m.isCorrect?"#10b981":"#ef4444",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"50px",color:"white",fontWeight:"bold",boxShadow:"0 10px 40px rgba(0,0,0,0.3)"},children:m.isCorrect?"‚úì":"‚úó"}),!m.isCorrect&&m.correctRomaji&&e.jsxs("div",{style:{fontSize:"24px",fontWeight:"700",color:"#10b981",fontStyle:"italic"},children:["Richtig: ",m.correctRomaji]})]})}),e.jsx("div",{style:{position:"relative",height:"600px",marginBottom:"var(--spacing-6)"},children:r.cardStack.map((l,n)=>e.jsx(G,{card:l,index:n,isActive:n===0,onSwipe:I,correctAnswer:n===0?r.correctAnswer:void 0},`${r.currentIndex+n}`))}),e.jsx(W,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-3)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{className:"text-sm font-medium text-primary",children:["Karte ",r.currentIndex+1," / ",r.totalCards]}),e.jsxs("span",{style:{fontSize:"14px",fontWeight:"600",color:"var(--color-primary)"},children:[Math.round((r.currentIndex+1)/r.totalCards*100),"%"]})]}),e.jsx("div",{style:{width:"100%",backgroundColor:"var(--color-surface-light)",borderRadius:"9999px",height:"8px"},children:e.jsx("div",{style:{background:"linear-gradient(to right, var(--color-primary), var(--color-secondary))",height:"8px",borderRadius:"9999px",transition:"width 0.3s ease",width:`${(r.currentIndex+1)/r.totalCards*100}%`}})})]})}),e.jsx(W,{children:e.jsxs("div",{className:"grid-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Richtig"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"#10b981",margin:0},children:r.stats.correct})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tertiary",style:{margin:0},children:"Falsch"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"#ef4444",margin:0},children:r.stats.incorrect})]})]})}),e.jsx(X,{children:e.jsx("p",{className:"text-sm text-tertiary",style:{width:"100%",textAlign:"center",margin:0},children:"Wische ‚û°Ô∏è richtig | Wische ‚¨ÖÔ∏è falsch"})})]})}export{B as default};
